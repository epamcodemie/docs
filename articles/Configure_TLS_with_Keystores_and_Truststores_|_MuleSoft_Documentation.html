<article class="doc">
 <h1 class="page">
  Configure TLS with Keystores and Truststores
 </h1>
 <div id="preamble">
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     TLS is a cryptographic protocol that provides communications security for your Mule app. TLS offers many different ways of exchanging keys for authentication, encrypting data, and guaranteeing message integrity. This topic describes TLS as supported by Mule and how to configure TLS in Mule apps.
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="tls_compatibility">
   <a class="anchor" href="#tls_compatibility">
   </a>
   TLS Compatibility Matrix
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     TLS compatibility differs by Mule deployment model and TLS version.
    </p>
   </div>
   <table class="tableblock frame-all grid-all fit-content spread">
    <colgroup>
     <col/>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <thead>
     <tr>
      <th class="tableblock halign-left valign-top">
       TLS Version
      </th>
      <th class="tableblock halign-left valign-top">
       On-Premises
      </th>
      <th class="tableblock halign-left valign-top">
       CloudHub
      </th>
      <th class="tableblock halign-left valign-top">
       Anypoint Runtime Fabric
      </th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td class="tableblock halign-left valign-top">
       <p class="tableblock">
        1.3
       </p>
      </td>
      <td class="tableblock halign-left valign-top">
       <p class="tableblock">
        Supported when running Mule on a JDK that supports TLS 1.3 but
        <em>
         not
        </em>
        enabled by default
       </p>
      </td>
      <td class="tableblock halign-left valign-top">
       <p class="tableblock">
        Supported for Mule apps hosted in this deployment model
       </p>
      </td>
      <td class="tableblock halign-left valign-top">
       <p class="tableblock">
        Supported and enabled when running on a JDK that supports TLS 1.3
       </p>
      </td>
     </tr>
     <tr>
      <td class="tableblock halign-left valign-top">
       <p class="tableblock">
        1.2
       </p>
      </td>
      <td class="tableblock halign-left valign-top" colspan="3">
       <p class="tableblock">
        Supported and enabled by all deployment models
       </p>
      </td>
     </tr>
     <tr>
      <td class="tableblock halign-left valign-top">
       <p class="tableblock">
        1.1
       </p>
      </td>
      <td class="tableblock halign-left valign-top" colspan="3">
       <p class="tableblock">
        Supported and enabled by all deployment models
       </p>
      </td>
     </tr>
    </tbody>
   </table>
  </div>
 </div>
 <div class="sect1">
  <h2 id="the-tlscontext-element">
   <a class="anchor" href="#the-tlscontext-element">
   </a>
   The tls:context Element
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The
     <code>
      tls:context
     </code>
     element is used for all connectors that support TLS. For example, you can configure TLS in HTTP (server and client), FTPS (client), Email (client) or Sockets (client) connectors, among others.
    </p>
   </div>
   <div class="admonitionblock note">
    <table>
     <tr>
      <td class="icon">
       <i class="fa icon-note" title="Note">
       </i>
      </td>
      <td class="content">
       <div class="paragraph">
        <p>
         If a connector supports TLS, Studio shows either:
        </p>
       </div>
       <div class="ulist">
        <ul>
         <li>
          <p>
           A
           <strong>
            TLS/SSL
           </strong>
           tab on that connector’s Global Elements Properties.
          </p>
         </li>
         <li>
          <p>
           A
           <strong>
            TLS Configuration
           </strong>
           field on the
           <strong>
            General
           </strong>
           tab of that connector’s Global Element Properties.
          </p>
         </li>
        </ul>
       </div>
      </td>
     </tr>
    </table>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="the-tls-enabled-server-and-client">
   <a class="anchor" href="#the-tls-enabled-server-and-client">
   </a>
   The TLS-Enabled Server and Client
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     A TLS-enabled server contains a private key and a public certificate:
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       The private key never leaves the server.
      </p>
     </li>
     <li>
      <p>
       The public certificate is exposed through TLS.
      </p>
     </li>
    </ul>
   </div>
   <div class="paragraph">
    <p>
     TLS-enabled clients verify that they trust the server by validating the public certificate against their own set of trusted certificates.
    </p>
   </div>
   <div class="paragraph">
    <p>
     To use TLS communications security in Mule 4, import certificates and private keys into a keystore file. Truststore files are also keystores that by convention include only public certificates of trusted servers.
    </p>
   </div>
   <div class="paragraph">
    <p>
     While there’s a default Java truststore, there is no default Java keystore in the standard JRE distribution. Add your own keystore to the TLS context. You likely already have corporate certificates for your client apps and don’t need to create them. Often, these certificates work with the JRE truststore, so no setup is required in the TLS context.
    </p>
   </div>
   <div class="paragraph">
    <p>
     A well-known Certificate Authority (CA) can generate certificates, or you can generate a certificate locally without external approval (self-signed certificate). A truststore contains certificates from trusted CAs that the client uses to verify a certificate presented by the server.
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="keystores-and-truststores">
   <a class="anchor" href="#keystores-and-truststores">
   </a>
   Keystores and Truststores
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The
     <code>
      tls:trust-store
     </code>
     and
     <code>
      tls:key-store
     </code>
     elements in a Mule configuration can reference a specific certificate and key, but if you don’t provide values for
     <code>
      tls:trust-store
     </code>
     , Mule uses the default Java truststore. Java updates the default trust store when you update Java, so getting regular updates is recommended to keep well-known CA certificates up-to-date.
    </p>
   </div>
   <div class="paragraph">
    <p>
     Truststore and keystore contents differ depending on whether they are used for clients or servers:
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       For servers: the truststore contains certificates of the trusted clients, the keystore contains the private and public key of the server.
      </p>
     </li>
     <li>
      <p>
       For clients: the truststore contains certificates of the trusted servers, the keystore contains the private and public key of the client.
      </p>
     </li>
    </ul>
   </div>
   <div class="paragraph">
    <p>
     Adding both a keystore and a truststore to the configuration implements two-way TLS authentication also known as mutual authentication.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The keystore contains one or two passwords:
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       <code>
        password
       </code>
       accesses the entire keystore file.
      </p>
     </li>
     <li>
      <p>
       <code>
        keyPassword
       </code>
       accesses the server’s private key inside the keystore.
      </p>
     </li>
    </ul>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="client-configuration">
   <a class="anchor" href="#client-configuration">
   </a>
   Client Configuration
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     If the
     <code>
      tls:context
     </code>
     has an empty truststore defined, then the default values of the JVM are used, which usually include a truststore with certificates for all the major certifying authorities. Consider the following scenarios:
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       When the truststore is defined inline:
      </p>
     </li>
    </ul>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre>&lt;tls:context name&gt;
    &lt;tls:trust-store /&gt;
&lt;/tls:context&gt;</pre>
    </div>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       When the truststore is defined with a global element:
      </p>
     </li>
    </ul>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre>&lt;tls:context name="example"&gt;
	&lt;tls:trust-store /&gt;
&lt;/tls:context&gt;</pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     If the client requires a certificate from the server that it is trying to connect to, then add the
     <code>
      tls:trust-store
     </code>
     element. Set
     <code>
      path
     </code>
     to the location of the truststore file that contains the certificates of the trusted servers.
    </p>
   </div>
   <div class="paragraph">
    <p>
     If the server validates certificates from the clients, then the
     <code>
      tls:key-store
     </code>
     element should be added with
     <code>
      path
     </code>
     set to the location of the keystore file that contains the private/public keys of the client.
    </p>
   </div>
   <div class="paragraph">
    <p>
     See
     <a href="#configure-tls-in-mule-4">
      Configure TLS in Mule 4
     </a>
     for configuration instructions.
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="server-configuration">
   <a class="anchor" href="#server-configuration">
   </a>
   Server Configuration
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The
     <code>
      tls:context
     </code>
     must contain a
     <code>
      tls:key-store
     </code>
     element to listen for a request using a secure connection such as HTTPS. Set
     <code>
      path
     </code>
     to the location of the keystore file that contains the private/public keys of the server.
    </p>
   </div>
   <div class="paragraph">
    <p>
     If the server needs to validate certificates from clients, add a
     <code>
      tls:trust-store
     </code>
     element and set
     <code>
      path
     </code>
     to the location of the trust store file that contains the certificates of the trusted clients.
    </p>
   </div>
   <div class="paragraph">
    <p>
     Mule supports many types of keystores, including:
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       <code>
        JCEKS
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        PKCS12
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        JKS
       </code>
      </p>
     </li>
    </ul>
   </div>
   <div class="paragraph">
    <p>
     Specify your keystore type in the JRE.
    </p>
   </div>
   <div class="paragraph">
    <p>
     To fully configure TLS for a Mule app:
    </p>
   </div>
   <div class="olist arabic">
    <ol class="arabic">
     <li>
      <p>
       <a href="#generate-a-keystore">
        Generate a keystore and a truststore
       </a>
       , using the Java Keytool from Oracle.
      </p>
     </li>
     <li>
      <p>
       <a href="#configure-tls-in-mule-4">
        Configure TLS globally for client or server in Mule
       </a>
       .
      </p>
     </li>
     <li>
      <p>
       <a href="#optional-specify-protocols-and-cipher-suites">
        Optional: Specify Protocols and Cipher Suites
       </a>
       .
      </p>
     </li>
    </ol>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="keystore-generation">
   <a class="anchor" href="#keystore-generation">
   </a>
   Keystore Generation
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The standard JDK distribution does not include a keystore by default, use
     <code>
      keytool
     </code>
     to generate your keystores and certificates. The keystore you generate contains a private key and a public certificate. This certificate is self-signed so it is not to be trusted by clients unless you share the public certificate with them.
    </p>
   </div>
   <div class="sect2">
    <h3 id="requirements">
     <a class="anchor" href="#requirements">
     </a>
     Requirements
    </h3>
    <div class="paragraph">
     <p>
      Use Java 17 to generate your keystores. Using a different JDK version generates an incompatible keystore that causes an invalid keystore format runtime error when the Mule application tries to read the keystore.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="generate-a-keystore">
     <a class="anchor" href="#generate-a-keystore">
     </a>
     Generate a Keystore
    </h3>
    <div class="paragraph">
     <p>
      Follow these steps to generate a keystore and export a self-signed certificate.
     </p>
    </div>
    <div class="olist arabic">
     <ol class="arabic">
      <li>
       <p>
        Generate a keystore that exposes your server’s credentials.
        <br/>
        For example, run one of the following commands:
       </p>
       <div class="listingblock">
        <div class="content">
         <pre>keytool -genkey -keyalg RSA -alias &lt;key-alias&gt; -keystore &lt;keystore-name&gt;.jks

keytool -genkey -alias &lt;key-alias&gt; -keyalg RSA -keystore &lt;keystore-name&gt;.jks -storepass &lt;password&gt;</pre>
        </div>
       </div>
       <div class="paragraph">
        <p>
         Replace
         <code>
          &lt;key-alias&gt;
         </code>
         with a unique alias of your choice.
        </p>
       </div>
       <div class="paragraph">
        <p>
         Replace
         <code>
          &lt;password&gt;
         </code>
         with a password of your choice.
        </p>
       </div>
       <div class="paragraph">
        <p>
         Replace
         <code>
          &lt;keystore-name&gt;
         </code>
         with the name you want for your keystore.
        </p>
       </div>
       <div class="paragraph">
        <p>
         Optionally, you can set the encryption algorithm to ECDSA by specifying
         <code>
          -keyalg EC
         </code>
         instead of
         <code>
          -keyalg RSA
         </code>
         .
        </p>
       </div>
       <div class="admonitionblock important">
        <table>
         <tr>
          <td class="icon">
           <i class="fa icon-important" title="Important">
           </i>
          </td>
          <td class="content">
           If you do not specify the encryption algorithm, the tool uses DSA by default which is not compatible with TLS 1.2 and causes the SSL handshake to fail when the Mule app receives an HTTPS request.
          </td>
         </tr>
        </table>
       </div>
      </li>
      <li>
       <p>
        Respond to the tool’s prompts. The following output shows example responses:
       </p>
       <div class="listingblock">
        <div class="content">
         <pre>Enter keystore password: mule123
Re-enter new password: mule123</pre>
        </div>
       </div>
      </li>
      <li>
       <p>
        Respond to prompts to enter other values. Enter your desired values. The following output shows example responses:
       </p>
       <div class="listingblock">
        <div class="content">
         <pre>What is your first and last name?  [Unknown]:  max
What is the name of your organizational unit? [Unknown]:  MuleSoft
What is the name of your organization? [Unknown]:  MuleSoft Inc
What is the name of your City or Locality?  [Unknown]:  San Francisco
What is the name of your State or Province?  [Unknown]:  CA
What is the two-letter country code for this unit?  [Unknown]:  01</pre>
        </div>
       </div>
      </li>
      <li>
       <p>
        In response to the following prompt, enter:
        <code>
         yes
        </code>
        .
       </p>
       <div class="listingblock">
        <div class="content">
         <pre>Is CN=max, OU=MuleSoft, O=MuleSoft Inc, L=San Francisco, ST=CA, C=01 correct?  [no]:  yes</pre>
        </div>
       </div>
      </li>
      <li>
       <p>
        Respond to the following prompt. For example, use the same password by pressing RETURN.
       </p>
       <div class="listingblock">
        <div class="content">
         <pre>Enter key password for &lt;key-alias&gt;  (RETURN if same as keystore password):</pre>
        </div>
       </div>
      </li>
      <li>
       <p>
        Enter the following command to export a self-signed certificate authenticating the public key.
       </p>
       <div class="listingblock">
        <div class="content">
         <pre>keytool -export -alias &lt;key-alias&gt; -keystore &lt;keystore-name&gt;.jks -file &lt;certificate-name&gt;.cer</pre>
        </div>
       </div>
       <div class="paragraph">
        <p>
         Replace
         <code>
          &lt;key-alias&gt;
         </code>
         with the same value used in the previous steps.
         <br/>
         Replace
         <code>
          &lt;keystore-name&gt;
         </code>
         with the same value used in the previous steps.
         <br/>
         Replace
         <code>
          &lt;certificate-name&gt;
         </code>
         with the name you want for your certificate.
        </p>
       </div>
      </li>
      <li>
       <p>
        Enter the password you set up for the keystore associated with the certificate:
       </p>
       <div class="listingblock">
        <div class="content">
         <pre>Enter keystore password: mule123</pre>
        </div>
       </div>
      </li>
     </ol>
    </div>
   </div>
   <div class="sect2">
    <h3 id="request-signing-by-a-certification-authority">
     <a class="anchor" href="#request-signing-by-a-certification-authority">
     </a>
     Request Signing by a Certification Authority
    </h3>
    <div class="paragraph">
     <p>
      If you want your certificate signed by a Certification Authority (CA), follow these steps:
     </p>
    </div>
    <div class="olist arabic">
     <ol class="arabic">
      <li>
       <p>
        Export your certificate in the standard CSR format. To do so you can run this command:
       </p>
       <div class="listingblock">
        <div class="content">
         <pre>keytool -certreq -keystore &lt;keystore-name&gt;.jks -alias &lt;key-alias&gt; -file &lt;certificate-name&gt;.csr</pre>
        </div>
       </div>
       <div class="paragraph">
        <p>
         Replace
         <code>
          &lt;key-alias&gt;
         </code>
         with the same value used in the previous steps.
         <br/>
         Replace
         <code>
          &lt;keystore-name&gt;
         </code>
         with the same value used in the previous steps.
         <br/>
         Replace
         <code>
          &lt;certificate-name&gt;
         </code>
         with the name you want for your certificate sign request file.
        </p>
       </div>
      </li>
      <li>
       <p>
        Send the CSR file generated in the previous step to the Certification Authority and follow their instructions to obtain their signature.
       </p>
      </li>
     </ol>
    </div>
    <div class="paragraph">
     <p>
      After you receive the CA’s signature, you can import the signed certificate file through the following command:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre>keytool -import -keystore &lt;keystore-name&gt;.jks -alias &lt;cert-alias&gt; -file &lt;signed_certificate_file&gt;</pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      Replace
      <code>
       &lt;cert-alias&gt;
      </code>
      with the a new desired value, the alias you define must not be linked to any existing key or the process fails.
      <br/>
      Replace
      <code>
       &lt;keystore-name&gt;
      </code>
      with the same value used in the previous steps.
      <br/>
      Replace
      <code>
       &lt;signed_certificate_file&gt;
      </code>
      with the name of the signed certificate you received from the Certification Authority.
     </p>
    </div>
    <div class="olist arabic">
     <ol class="arabic">
      <li>
       <p>
        Export your certificate in the standard PEM format. First verify the keystore type, then export the certificates:
       </p>
      </li>
     </ol>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre>keytool -list -v -keystore &lt;keystore-name&gt;.jks</pre>
     </div>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre>openssl &lt;keystore-type&gt; -in &lt;keystore-name&gt;.jks -out &lt;pem-name&gt;.key.pem -nocerts -nodes
openssl &lt;keystore-type&gt; -in &lt;keystore-name&gt;.jks -out &lt;pem-name&gt;.crt.pem -nocerts -nodes</pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      Replace
      <code>
       &lt;keystore-type&gt;
      </code>
      with the new desired value in keystore type format, for example PKCS12.
      <br/>
      Replace
      <code>
       &lt;keystore-name&gt;
      </code>
      with the name you want for the keystore.
      <br/>
      Replace
      <code>
       &lt;pem-name&gt;
      </code>
      with the name you want for the PEM file.
     </p>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="truststore-generation">
   <a class="anchor" href="#truststore-generation">
   </a>
   Truststore Generation
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The standard JRE distribution includes a default trust store with certificates for several major certificate authorities (CA’s) which is used by default in the 'tls:trust-store' element, but you can generate your own if you want greater security or if you use self-signed certificates.
    </p>
   </div>
   <div class="paragraph">
    <p>
     To create a trust store, you can use the Oracle Java keytool.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The client trusts the server if a chain of trust can be established, either directly to the server (in case its certificate is in the truststore) or through a signing CA whose certificate is present in the truststore; otherwise, the connection fails. A trust store must be defined when using self-signed certificates.
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="configure-tls-in-mule-4">
   <a class="anchor" href="#configure-tls-in-mule-4">
   </a>
   Configure TLS in Mule 4
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     To enable TLS for Mule apps, configure the
     <code>
      tls:context
     </code>
     element in the Mule XML configuration file in one of three ways:
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       <a href="#edit-xml-to-configure-tls">
        Edit the XML file directly.
       </a>
      </p>
     </li>
     <li>
      <p>
       <a href="#use-anypoint-studio-to-configure-tls">
        Use Anypoint Studio 7.
       </a>
      </p>
     </li>
     <li>
      <p>
       <a href="#use-design-center-to-configure-tls">
        Use Design Center.
       </a>
      </p>
     </li>
    </ul>
   </div>
   <div class="paragraph">
    <p>
     Whichever method you use, we recommend you review the information in
     <a href="#edit-xml-to-configure-tls">
      Edit XML to Configure TLS
     </a>
     to understand how the attributes of
     <code>
      tls:context
     </code>
     function.
    </p>
   </div>
   <div class="sect2">
    <h3 id="edit-xml-to-configure-tls">
     <a class="anchor" href="#edit-xml-to-configure-tls">
     </a>
     Edit XML to Configure TLS
    </h3>
    <div class="paragraph">
     <p>
      The
      <code>
       tls:context
      </code>
      element defines TLS communication in a Mule app. Unless you have a special requirement, configure TLS globally and then apply it to each specific use, such as listening for or sending HTTPS requests.
     </p>
    </div>
    <div class="sect3">
     <h4 id="globally-define-a-tls-element">
      <a class="anchor" href="#globally-define-a-tls-element">
      </a>
      Globally Define a TLS Element
     </h4>
     <div class="paragraph">
      <p>
       The
       <code>
        tls:context
       </code>
       element defines a configuration for TLS, which can be used from both the client and server sides. The element can be referenced by other configuration objects of other modules or defined as a nested element of one of them.
      </p>
     </div>
     <div class="paragraph">
      <p>
       Include at least one of the nested elements: key-store and trust-store.
      </p>
     </div>
     <div class="listingblock">
      <div class="content">
       <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;tls:context name="customContext"&gt;
    &lt;tls:trust-store path="trustStore" password="mulepassword"/&gt;
    &lt;tls:key-store path="clientKeystore" keyPassword="mulepassword" type="pkcs12"
password="mulepassword"/&gt;
 &lt;/tls:context&gt;</code></pre>
      </div>
     </div>
    </div>
    <div class="sect3">
     <h4 id="optional-attributes-of-the-tls-context-element">
      <a class="anchor" href="#optional-attributes-of-the-tls-context-element">
      </a>
      Optional Attributes of the
      <code>
       tls-context
      </code>
      Element
     </h4>
     <div class="paragraph">
      <p>
       Optionally, specify the protocol and cipher suite to enable them:
      </p>
     </div>
     <div class="ulist">
      <ul>
       <li>
        <p>
         <code>
          enabledProtocols
         </code>
         : The protocols in the global TLS configuration
        </p>
       </li>
       <li>
        <p>
         <code>
          enabledCipherSuites
         </code>
         : The cipher suites in global TLS configuration
        </p>
       </li>
      </ul>
     </div>
     <div class="paragraph">
      <p>
       These values are used if there is nothing specified in the global TLS configuration, or if the values are enabled in a global TLS configuration, as described in
       <a href="#optional-specify-protocols-and-cipher-suites">
        Optional: Specify Protocols and Cipher Suites
       </a>
       .
      </p>
     </div>
    </div>
    <div class="sect3">
     <h4 id="attributes-of-the-trust-store-element">
      <a class="anchor" href="#attributes-of-the-trust-store-element">
      </a>
      Attributes of the
      <code>
       trust-store
      </code>
      Element
     </h4>
     <div class="paragraph">
      <p>
       The
       <code>
        password
       </code>
       attribute is required if you specify a
       <code>
        path
       </code>
       . Otherwise, the attributes are optional.
      </p>
     </div>
     <div class="ulist">
      <ul>
       <li>
        <p>
         <code>
          path
         </code>
         : The path to the file that contains the trust store
        </p>
       </li>
       <li>
        <p>
         <code>
          type
         </code>
         : The type of the trust store. Default = JKS
        </p>
       </li>
       <li>
        <p>
         <code>
          password
         </code>
         : The trust store password (required if you specify
         <code>
          path
         </code>
         )
        </p>
       </li>
       <li>
        <p>
         <code>
          algorithm
         </code>
         : The algorithm the trust store uses. Default =
         <code>
          SunX509
         </code>
        </p>
       </li>
       <li>
        <p>
         <code>
          insecure
         </code>
         : Boolean that determines whether or not to validate the truststore. If set to
         <code>
          true
         </code>
         , no validation occurs. The default value is
         <code>
          false
         </code>
         .
        </p>
       </li>
      </ul>
     </div>
     <div class="admonitionblock important">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-important" title="Important">
         </i>
        </td>
        <td class="content">
         Setting
         <code>
          insecure
         </code>
         to
         <code>
          true
         </code>
         renders connections vulnerable to attack. Use it only for prototyping or testing. Never use it in production environments.
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="sect3">
     <h4 id="attributes-of-the-key-store-element">
      <a class="anchor" href="#attributes-of-the-key-store-element">
      </a>
      Attributes of the
      <code>
       key-store
      </code>
      Element
     </h4>
     <div class="paragraph">
      <p>
       The attributes other than
       <code>
        path
       </code>
       are optional.
      </p>
     </div>
     <div class="ulist">
      <ul>
       <li>
        <p>
         <code>
          path
         </code>
         : The path to the file that contains the keystore (required)
        </p>
       </li>
       <li>
        <p>
         <code>
          type
         </code>
         : The type of the keystore (default JKS)
        </p>
       </li>
       <li>
        <p>
         <code>
          password
         </code>
         : The keystore password
        </p>
       </li>
       <li>
        <p>
         <code>
          keyPassword
         </code>
         : The key manager password, which is the password for the private key inside the keystore
        </p>
       </li>
       <li>
        <p>
         <code>
          algorithm
         </code>
         : The algorithm used in the keystore. The default value is
         <code>
          SunX509
         </code>
         .
        </p>
       </li>
      </ul>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="use-design-center-to-configure-tls">
     <a class="anchor" href="#use-design-center-to-configure-tls">
     </a>
     Use Design Center to Configure TLS
    </h3>
    <div class="paragraph">
     <p>
      You can configure TLS for your app in Design Center. For example, to configure TLS in HTTP Listener:
     </p>
    </div>
    <div class="olist arabic">
     <ol class="arabic">
      <li>
       <p>
        Log into Design Center.
       </p>
      </li>
      <li>
       <p>
        Open the project.
       </p>
      </li>
      <li>
       <p>
        Open HTTP Listener.
       </p>
      </li>
      <li>
       <p>
        In the Configuration tab, click
        <strong>
         Edit
        </strong>
        .
       </p>
      </li>
      <li>
       <p>
        In the TLS tab, fill in the TLS Configuration fields as described above.
       </p>
      </li>
      <li>
       <p>
        Optionally, fill in the
        <strong>
         Enabled Protocols
        </strong>
        and
        <strong>
         Enabled Cipher Suites
        </strong>
        fields as described in
        <a href="#optional-specify-protocols-and-cipher-suites">
         Optional: Specify Protocols and Cipher Suites
        </a>
        .
       </p>
      </li>
     </ol>
    </div>
    <div class="paragraph">
     <p>
      Save your configuration and test.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="use-anypoint-studio-to-configure-tls">
     <a class="anchor" href="#use-anypoint-studio-to-configure-tls">
     </a>
     Use Anypoint Studio to Configure TLS
    </h3>
    <div class="paragraph">
     <p>
      You can configure TLS for your app in Anypoint Studio (Studio). For example, to configure TLS in HTTP Listener:
     </p>
    </div>
    <div class="olist arabic">
     <ol class="arabic">
      <li>
       <p>
        Open Studio Center.
       </p>
      </li>
      <li>
       <p>
        Open the project.
       </p>
      </li>
      <li>
       <p>
        Open HTTP Listener.
       </p>
      </li>
      <li>
       <p>
        In the General tab, select an existing configuration or create a new one.
       </p>
      </li>
      <li>
       <p>
        In the HTTP Listener config dialog, select the TLS tab.
       </p>
      </li>
      <li>
       <p>
        In the TLS tab, choose the TLS Configuration type
        <strong>
         Edit Inline
        </strong>
        , and supply the values.
       </p>
      </li>
      <li>
       <p>
        Optionally, fill in the
        <strong>
         Enabled Protocols
        </strong>
        and
        <strong>
         Enabled Cipher Suites
        </strong>
        fields in the Advanced section as described in
        <a href="#optional-specify-protocols-and-cipher-suites">
         Optional: Specify Protocols and Cipher Suites
        </a>
        .
       </p>
      </li>
     </ol>
    </div>
    <div class="paragraph">
     <p>
      Save your configuration and test.
     </p>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="optional-specify-protocols-and-cipher-suites">
   <a class="anchor" href="#optional-specify-protocols-and-cipher-suites">
   </a>
   Optional: Specify Protocols and Cipher Suites
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     When a TLS communication takes place between two systems, a negotiation determines which protocol and cipher suite are used. Optionally, administrators can specify the protocols and cipher suites to use, and then app developers can specify which cipher suites and protocols to use in
     <code>
      tls:context
     </code>
     .
    </p>
   </div>
   <div class="admonitionblock note">
    <table>
     <tr>
      <td class="icon">
       <i class="fa icon-note" title="Note">
       </i>
      </td>
      <td class="content">
       Protocols and cipher suites must be enabled in Mule runtime and individual apps to be used. If the protocols and cipher suites aren’t enabled in both places, the default Java environment protocol and cipher suites are used.
      </td>
     </tr>
    </table>
   </div>
   <div class="paragraph">
    <p>
     To configure protocols and cipher suites in the Mule runtime:
    </p>
   </div>
   <div class="olist arabic">
    <ol class="arabic">
     <li>
      <p>
       The Mule admin edits the
       <code>
        /conf
       </code>
       directory in
       <code>
        $MULE_HOME
       </code>
       .
       <code>
        $MULE_HOME
       </code>
       points to the directory where your Mule installation resides, for example
       <code>
        /opt/mule-4.0
       </code>
       . Select the appropriate file where you specify the cipher suites and protocols:
      </p>
      <div class="ulist">
       <ul>
        <li>
         <p>
          <code>
           tls-default.conf
          </code>
          allows fine-tuning when Mule is not configured to run in Federal Information Processing Standards (FIPS) security mode.
         </p>
        </li>
        <li>
         <p>
          <code>
           tls-fips140-2.conf
          </code>
          allows fine-tuning when Mule is running in FIPS security mode.
         </p>
         <div class="paragraph">
          <p>
           Open the relevant file and comment or uncomment items in the lists to manually configure the allowed cipher suites and TLS protocols. If you make no changes to these files, Mule allows the configured security manager to select cipher suites and protocols for an app.
          </p>
         </div>
        </li>
       </ul>
      </div>
     </li>
     <li>
      <p>
       The list of protocols and cipher suites that the admin sets in these configuration files can then be constrained locally by what the app developer specifies in an individual
       <code>
        tls:context
       </code>
       element. The app developer specifies a subset of the configured or default values in the
       <code>
        tls:context
       </code>
       element for use by TLS. Configure the protocols and cipher suites in
       <code>
        enabledProtocols
       </code>
       and
       <code>
        enabledCipherSuites
       </code>
       in the
       <code>
        tls:context
       </code>
       element.
      </p>
     </li>
    </ol>
   </div>
   <div class="paragraph">
    <p>
     In the
     <code>
      tls:context
     </code>
     element, you can only reference protocols or cipher suites that are included in the Mule global TLS configuration file or defaults. In
     <code>
      tls:context
     </code>
     , set
     <code>
      enabledProtocols
     </code>
     and
     <code>
      enabledCipherSuite
     </code>
     for a Mule app to the value
     <code>
      default
     </code>
     . After these values are set, TLS uses the following protocols and cipher suites:
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       Those configured in your global TLS configuration if it exists
      </p>
     </li>
     <li>
      <p>
       The defaults provided by your Java environment if a global TLS configuration does not exist
      </p>
     </li>
    </ul>
   </div>
   <div class="paragraph">
    <p>
     Cipher suite names can be long and reduce the readability of your XML code. To improve readability, keep these names in an external properties file in your Mule project. You can then reference the properties. For example:
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;tls:context name="serverTlsContext" enabledCipherSuites="${myCipherSuites}" &gt;</code></pre>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="test-after-deployment-example">
   <a class="anchor" href="#test-after-deployment-example">
   </a>
   Test after deployment Example
  </h2>
  <div class="sectionbody">
   <div class="listingblock">
    <div class="content">
     <pre>time curl -i -k --cert ./&lt;pem-name&gt;.crt.pem --cert-type PEM --key ./&lt;pem-name&gt;.key.pem https://&lt;anypoint-address&gt;:&lt;anypoint-port&gt;</pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     Replace
     <code>
      &lt;pem-name&gt;
     </code>
     with the value name defined.
     <br/>
     Replace
     <code>
      &lt;anypoint-address&gt;
     </code>
     with the value name defined by Anypoint Platform.
     <br/>
     Replace
     <code>
      &lt;anypoint-port&gt;
     </code>
     with the value name defined in the Mule application.
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="tls-configuration-examples">
   <a class="anchor" href="#tls-configuration-examples">
   </a>
   TLS Configuration Examples
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     You can set up TLS in a Mule XML configuration file for a client or a server.
    </p>
   </div>
   <div class="sect2">
    <h3 id="example-configuring-tls-for-a-client">
     <a class="anchor" href="#example-configuring-tls-for-a-client">
     </a>
     Example: Configuring TLS for a Client
    </h3>
    <div class="paragraph">
     <p>
      This example secures an FTPS client by setting up a truststore:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ftps:config name="ftps"&gt;
    &lt;ftps:connection username="anonymous" password="password" host="localhost" port="21" workingDir="/dev"&gt;
        &lt;tls:context &gt;
            &lt;tls:trust-store path="trustStore" password="mulepassword" /&gt;
        &lt;/tls:context&gt;
    &lt;/ftps:connection&gt;
&lt;/ftps:config&gt;</code></pre>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="example-configuring-tls-for-a-server">
     <a class="anchor" href="#example-configuring-tls-for-a-server">
     </a>
     Example: Configuring TLS for a Server
    </h3>
    <div class="paragraph">
     <p>
      This example secures an HTTP listener by setting up a keystore:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;http:listener-config name="nestedConfig"&gt;
    &lt;http:listener-connection protocol="HTTPS" host="localhost" port="8081"&gt;
        &lt;tls:context&gt;
            &lt;tls:key-store path="tls/ssltest-keystore.jks" keyPassword="changeit" password="changeit"/&gt;
        &lt;/tls:context&gt;
    &lt;/http:listener-connection&gt;
&lt;/http:listener-config&gt;</code></pre>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="example-configuring-tls-for-two-way-authentication">
     <a class="anchor" href="#example-configuring-tls-for-two-way-authentication">
     </a>
     Example: Configuring TLS for Two-Way Authentication
    </h3>
    <div class="paragraph">
     <p>
      This example sets up two-way authentication (also called mutual authentication), for an HTTP listener:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;http:listener-config name="nestedConfig"&gt;
    &lt;http:listener-connection protocol="HTTPS" host="localhost" port="8081"&gt;
        &lt;tls:context&gt;
            &lt;tls:trust-store path="tls/ssltest-cacerts.jks" password="changeit"/&gt;
            &lt;tls:key-store path="tls/ssltest-keystore.jks" keyPassword="changeit" password="changeit"/&gt;
        &lt;/tls:context&gt;
    &lt;/http:listener-connection&gt;
&lt;/http:listener-config&gt;</code></pre>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="example-disabling-tls-validations">
     <a class="anchor" href="#example-disabling-tls-validations">
     </a>
     Example: Disabling TLS Validations
    </h3>
    <div class="paragraph">
     <p>
      This example uses the
      <code>
       insecure
      </code>
      property to disable validations for prototyping and development.
     </p>
    </div>
    <div class="admonitionblock important">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-important" title="Important">
        </i>
       </td>
       <td class="content">
        Do not use the
        <code>
         insecure
        </code>
        property in production environments.
       </td>
      </tr>
     </table>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;tls:context&gt;
    &lt;tls:trust-store path="tls/ssltest-cacerts.jks" password="changeit" insecure="true"/&gt;
&lt;/tls:context&gt;</code></pre>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="example-adding-additional-cipher-suites-and-protocol-restrictions">
     <a class="anchor" href="#example-adding-additional-cipher-suites-and-protocol-restrictions">
     </a>
     Example: Adding Additional Cipher Suites and Protocol Restrictions
    </h3>
    <div class="paragraph">
     <p>
      This example enables a protocol and cipher suite for an app, assuming a Mule admin has either specified nothing in the global TLS configuration or enabled the cipher suites and protocols being specified here. Use IANA (Internet Assigned Numbers Authority) naming convention for the cipher suites. Check the
      <a href="https://testssl.sh/openssl-iana.mapping.html">
       OpenSSL - IANA mapping
      </a>
      for reference.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;tls:context name="tlsClientContext" enabledProtocols="TLSv1.2" enabledCipherSuites="TLS_DHE_DSS_WITH_AES_128_CBC_SHA256"&gt;
    &lt;tls:trust-store path="tls/trustStore" password="mulepassword"/&gt;
&lt;/tls:context&gt;</code></pre>
     </div>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="see-also">
   <a class="anchor" href="#see-also">
   </a>
   See Also
  </h2>
  <div class="sectionbody">
   <div class="ulist">
    <ul>
     <li>
      <p>
       <a href="http://docs.oracle.com/javase/8/docs/technotes/tools/#security" rel="noopener" target="_blank">
        Oracle security
       </a>
      </p>
     </li>
     <li>
      <p>
       <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html" rel="noopener" target="_blank">
        Oracle Java keytool
       </a>
      </p>
     </li>
    </ul>
   </div>
  </div>
 </div>
</article>
