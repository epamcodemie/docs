<article class="doc">
 <h1 class="page">
  Camel Kubernetes plugin
 </h1>
 <div id="preamble">
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     This plugin helps you to get started with running Camel applications on Kubernetes. Please make sure to meet these prerequisites for running Camel integrations on Kubernetes:
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       Install a Kubernetes command line tooling (
       <a href="https://kubernetes.io/docs/tasks/tools/#kubectl">
        kubectl
       </a>
       )
      </p>
     </li>
     <li>
      <p>
       Connect to a running Kubernetes cluster where you want to run the Camel integration
      </p>
     </li>
    </ul>
   </div>
   <div class="paragraph">
    <p>
     You can connect to a remote Kubernetes cluster or set up a local cluster. To set up a local Kubernetes cluster, you have a variety of options.
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       <a href="https://kind.sigs.k8s.io/docs/user/quick-start/">
        Kind
       </a>
      </p>
     </li>
     <li>
      <p>
       <a href="https://minikube.sigs.k8s.io/docs/start/">
        Minikube
       </a>
      </p>
     </li>
    </ul>
   </div>
   <div class="paragraph">
    <p>
     Camel JBang is able to interact with any of these Kubernetes platforms (remote or local).
    </p>
   </div>
   <div class="paragraph">
    <p>
     Running Camel routes on Kubernetes is quite simple with Camel JBang. In fact, you can develop and test your Camel route locally with Camel JBang and then promote the same source to running it as an integration on Kubernetes.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The Camel JBang Kubernetes functionality is provided as a command plugin. This means you need to enable the
     <code>
      kubernetes
     </code>
     plugin first to use the subcommands in Camel JBang.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel plugin add kubernetes</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     You should see the
     <code>
      kubernetes
     </code>
     plugin listed as an installed plugin.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel plugin get</code></pre>
    </div>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"> NAME        COMMAND     DEPENDENCY                                      DESCRIPTION
 kubernetes  kubernetes  org.apache.camel:camel-jbang-plugin-kubernetes  Run Camel applications on Kubernetes</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     Now Camel JBang is able to run the subcommands offered by the plugin. You can inspect the help page to see the list of available plugin subcommands.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes --help</code></pre>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_kubernetes_export">
   <a class="anchor" href="#_kubernetes_export">
   </a>
   Kubernetes export
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The Kubernetes plugin works with the Camel JBang export functionality. The project export generates a proper Maven/Gradle project following one of the available runtime types Quarkus, SpringBoot or camel-main.
    </p>
   </div>
   <div class="paragraph">
    <p>
     In case you export the project with the Kubernetes plugin the exported project holds all information (e.g. sources, properties, dependencies, etc.) and is ready to build, push and deploy the application to Kubernetes, too. The export generates a Kubernetes manifest (kubernetes.yml) that holds all resources (e.g. Deployment, Service, ConfigMap) required to run the application on Kubernetes.
    </p>
   </div>
   <div class="paragraph">
    <p>
     You can create a project export with the following command.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export route.yaml --dir some/path/to/project</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     The command receives one or more source files (e.g. Camel routes), and performs the export. As a result, you will find the Maven/Gradle project sources generated into the given project path.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The default runtime of the project is Quarkus. You can adjust the runtime with an additional command option
     <code>
      --runtime=quarkus
     </code>
     .
    </p>
   </div>
   <div class="paragraph">
    <p>
     If you want to run this application on Kubernetes, you need to build the container image, push it to a registry and deploy the application to Kubernetes.
    </p>
   </div>
   <div class="admonitionblock tip">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-tip" title="Tip">
        </i>
       </td>
       <td class="content">
        The Camel JBang Kubernetes plugin provides a
        <code>
         run
        </code>
        command that combines these steps (export, container image build, push, deploy) into a single command.
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="paragraph">
    <p>
     You can now navigate to the generated project folder and build the project artifacts for instance with this Maven command.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Dquarkus.container-image.build=true</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     According to the runtime type (e.g., quarkus) defined for the export this builds and creates a Quarkus application artifact JAR in the Maven build output folder (e.g.
     <code>
      target/route-1.0-SNAPSHOT.jar
     </code>
     ).
    </p>
   </div>
   <div class="paragraph">
    <p>
     The option
     <code>
      -Dquarkus.container-image.build=true
     </code>
     also builds a container image that is ready for deployment to Kubernetes. More precisely, the exported project uses the very same tooling and options as an arbitrary Quarkus/SpringBoot application would do. This means you can easily customize the container image and all settings provided by the runtime provider (e.g., Quarkus or SpringBoot) after the export.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The Kubernetes deployment resources are automatically generated with the export, too.
    </p>
   </div>
   <div class="paragraph">
    <p>
     You can find the Kubernetes manifest in
     <code>
      src/main/kubernetes/kubernetes.yml
     </code>
     .
    </p>
   </div>
   <div class="paragraph">
    <p>
     For instance with the option
     <code>
      -Dquarkus.kubernetes.deploy=true
     </code>
     uses this manifest to trigger the Kubernetes deployment as part of the Maven build.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Dquarkus.kubernetes.deploy=true</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     You will see the Deployment on Kubernetes shortly after this command has finished.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The Camel JBang Kubernetes export command provides several options to customize the exported project.
    </p>
   </div>
   <div class="table-wrapper">
    <table class="tableblock frame-all grid-all stretch">
     <colgroup>
      <col/>
      <col/>
     </colgroup>
     <thead>
      <tr>
       <th class="tableblock halign-left valign-top">
        Option
       </th>
       <th class="tableblock halign-left valign-top">
        Description
       </th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --service-account
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         The service account used to run the application.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --dependency
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Adds dependency that should be included, use "camel:" prefix for a Camel component, "mvn:org.my:app:1.0" for a Maven dependency.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --build-property
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Maven/Gradle build properties (syntax: --build-property=prop1=foo)
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --property
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Add a runtime property or properties file from a path, a config map or a secret (syntax: [my-key=my-value,file:/path/to/my-conf.properties,[configmap,secret]:name]).
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --config
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Add a runtime configuration from a ConfigMap or a Secret (syntax: [configmap,secret]:name[/key], where name represents the configmap/secret name and key optionally represents the configmap/secret key to be filtered).
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --resource
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Add a runtime resource from a Configmap or a Secret (syntax: [configmap,secret]:name[/key][@path], where name represents the configmap/secret name, key optionally represents the configmap/secret key to be filtered and path represents the destination path).
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --open-api
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Add an OpenAPI spec (syntax: [configmap,file]:name).
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --env
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Set an environment variable in the integration container, for instance "-e MY_VAR=my-value".
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --volume
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Mount a volume into the integration container, for instance "-v pvcname:/container/path".
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --connect
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         A Service that the integration should bind to, specified as [[apigroup/]version:]kind:[namespace/]name.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --source
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Add the source file to your integration, this is added to the list of files listed as arguments of the command.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --annotation
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Add an annotation to the integration. Use name values pairs like "--annotation my.company=hello".
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --label
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Add a label to the integration. Use name values pairs like "--label my.company=hello".
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --trait
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Add a trait configuration to the integration. Use name values pairs like "--trait trait.name.config=hello".
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --image
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         An image built externally (for instance via CI/CD). Enabling it will skip the integration build phase.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --image-registry
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         The image registry to hold the app container image.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --image-group
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         The image registry group used to push images to.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --image-builder
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         The image builder used to build the container image (e.g. docker, jib, podman, s2i).
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --image-platform
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         List of target platforms. Each platform is defined using os and architecture (e.g. linux/amd64).
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --base-image
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         The base image that is used to build the container image from (default is eclipse-temurin:&lt;java-version&gt;).
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --registry-mirror
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         Optional Docker registry mirror where to pull images from when building the container image.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --cluster-type
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         The target cluster type. Special configurations may be applied to different cluster types such as Kind or Minikube.
        </p>
       </td>
      </tr>
      <tr>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         <code>
          --profile
         </code>
        </p>
       </td>
       <td class="tableblock halign-left valign-top">
        <p class="tableblock">
         The developer
         <a class="xref page" href="camel-jbang.html#_using_profiles">
          profile
         </a>
         to use a specific configuration in configuration files using the naming style
         <code>
          application-&lt;profile&gt;.properties
         </code>
         .
        </p>
       </td>
      </tr>
     </tbody>
    </table>
   </div>
   <div class="paragraph">
    <p>
     The Kubernetes plugin export command also inherits all options from the arbitrary Camel JBang export command.
    </p>
   </div>
   <div class="admonitionblock tip">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-tip" title="Tip">
        </i>
       </td>
       <td class="content">
        See the possible options by running:
        <code>
         camel kubernetes export --help
        </code>
        for more details.
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_kubernetes_container_health_probes">
     <a class="anchor" href="#_kubernetes_container_health_probes">
     </a>
     Kubernetes Container Health Probes
    </h3>
    <div class="paragraph">
     <p>
      The Observability Services component is set by default in the project created by the export command, then the health path probes are prefixed with the
      <code>
       /observe
      </code>
      endpoint, regardless if they are Quarkus or Spring Boot.
     </p>
    </div>
    <div class="paragraph">
     <p>
      These are the HTTP Container probe endpoints.
     </p>
    </div>
    <div class="paragraph">
     <p>
      For Quarkus.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-none hljs">/observe/health/live
/observe/health/ready
/observe/health/started</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      For Spring Boot (there is no startup probe)
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-none hljs">/observe/health/liveness
/observe/health/readiness</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      Note that these container probes are generated by jkube plugin, when you run the
      <code>
       k8s:resource
      </code>
      to generate the manifests in the
      <code>
       target/kubernetes/kubernetes.yml
      </code>
      .
     </p>
    </div>
    <div class="paragraph">
     <p>
      You can export to a project and manually remove the
      <code>
       camel-observability-services
      </code>
      artifact from the
      <code>
       pom.xml
      </code>
      .
     </p>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_kubernetes_manifest_options">
   <a class="anchor" href="#_kubernetes_manifest_options">
   </a>
   Kubernetes manifest options
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The Kubernetes manifest (kubernetes.yml) describes all resources to successfully run the application on Kubernetes. The manifest usually holds the deployment, a service definition, config maps and much more.
    </p>
   </div>
   <div class="paragraph">
    <p>
     You can use several options on the
     <code>
      export
     </code>
     command to customize this manifest with the traits. The trait concept was born out of Camel K, and the Camel K operator uses the traits to configure the Kubernetes resources that are managed by an integration. You can use the same options to also customize the Kubernetes manifest that is generated as part of the project export.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The configuration of the traits is used by the given order:
    </p>
   </div>
   <div class="olist arabic">
    <ol class="arabic">
     <li>
      <p>
       Use the
       <code>
        --trait
       </code>
       command options values
      </p>
     </li>
     <li>
      <p>
       Any annotation starting with the prefix
       <code>
        trait.camel.apache.org/*
       </code>
      </p>
     </li>
     <li>
      <p>
       Any properties from the specific configuration
       <code>
        application-&lt;profile&gt;.properties
       </code>
       for the profile defined by the command option
       <code>
        --profile
       </code>
       with the prefix
       <code>
        camel.jbang.trait.*
       </code>
      </p>
     </li>
     <li>
      <p>
       Any properties from the default configuration
       <code>
        application.properties
       </code>
       with the prefix
       <code>
        camel.jbang.trait.*
       </code>
      </p>
     </li>
    </ol>
   </div>
   <div class="sect2">
    <h3 id="_container_trait_options">
     <a class="anchor" href="#_container_trait_options">
     </a>
     Container trait options
    </h3>
    <div class="paragraph">
     <p>
      The container specification is part of the Kubernetes Deployment resource and describes the application container image, exposed ports and health probes, for example.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The container trait is able to customize the container specification with the following options:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.port
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           int
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure a different port exposed by the container (default
            <code>
             8080
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.port-name
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure a different port name for the port exposed by the container. It defaults to
            <code>
             http
            </code>
            only when the
            <code>
             expose
            </code>
            parameter is true.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.service-port
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           int
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure under which service port the container port is to be exposed (default
            <code>
             80
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.service-port-name
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure under which service port name the container port is to be exposed (default
            <code>
             http
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.name
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The application container name.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.image
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The application container image to use for the Deployment.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.image-pull-policy
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           PullPolicy
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The pull policy: Always|Never|IfNotPresent
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.image-pull-secrets
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string[]
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The pull secrets for private registries
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.request-cpu
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The minimum amount of CPU required.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.request-memory
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The minimum amount of memory required.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.limit-cpu
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The maximum amount of CPU required.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.limit-memory
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The maximum amount of memory required.
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="paragraph">
     <p>
      The syntax to specify container trait options is as follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait container.[key]=[value]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      You may specify these options with the export command to customize the container specification.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait container.name=my-container --trait container.port=8088 --trait container.imagePullPolicy=IfNotPresent --trait container.request-cpu=0.005 --trait container.request-memory=100Mi</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This results in the following container specification in the Deployment resource.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    camel.apache.org/integration: sample
  name: sample
spec:
  selector:
    matchLabels:
      camel.apache.org/integration: sample
  template:
    metadata:
      labels:
        camel.apache.org/integration: sample
    spec:
      containers:
      - image: quay.io/sample:1.0-SNAPSHOT <i class="conum" data-value="1"></i><b>(1)</b>
        imagePullPolicy: IfNotPresent <i class="conum" data-value="2"></i><b>(2)</b>
        name: my-container <i class="conum" data-value="3"></i><b>(3)</b>
        ports:
        - containerPort: 8088 <i class="conum" data-value="4"></i><b>(4)</b>
          name: http
          protocol: TCP
        resources:
          requests:
            memory: 100Mi
            cpu: '0.005'</code></pre>
     </div>
    </div>
    <div class="colist arabic">
     <div class="table-wrapper">
      <table>
       <tr>
        <td>
         <i class="conum" data-value="1">
         </i>
         <b>
          1
         </b>
        </td>
        <td>
         Container image running the application
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="2">
         </i>
         <b>
          2
         </b>
        </td>
        <td>
         Customized image pull policy
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="3">
         </i>
         <b>
          3
         </b>
        </td>
        <td>
         Custom container name
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="4">
         </i>
         <b>
          4
         </b>
        </td>
        <td>
         Custom container port exposed
        </td>
       </tr>
      </table>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_labels_and_annotations">
     <a class="anchor" href="#_labels_and_annotations">
     </a>
     Labels and annotations
    </h3>
    <div class="paragraph">
     <p>
      You may need to add labels or annotations to the generated Kubernetes resources. By default, the generated resources will have the label
      <code>
       camel.apache.org/integration
      </code>
      set to the exported project name.
     </p>
    </div>
    <div class="paragraph">
     <p>
      You can add labels and annotations with these options on the export command:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --annotation [key]=[value] --label [key]=[value]</code></pre>
     </div>
    </div>
    <div class="listingblock">
     <div class="title">
      Example
     </div>
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --annotation project.team=camel-experts</code></pre>
     </div>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    project.team: camel-experts <i class="conum" data-value="1"></i><b>(1)</b>
  labels:
    camel.apache.org/integration: sample
  name: sample
spec:
  selector:
    matchLabels:
      camel.apache.org/integration: sample
  template:
    metadata:
      labels:
        camel.apache.org/integration: sample
    spec:
      containers:
      - image: quay.io/sample:1.0-SNAPSHOT
        name: sample</code></pre>
     </div>
    </div>
    <div class="colist arabic">
     <div class="table-wrapper">
      <table>
       <tr>
        <td>
         <i class="conum" data-value="1">
         </i>
         <b>
          1
         </b>
        </td>
        <td>
         Custom deployment annotation
        </td>
       </tr>
      </table>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_environment_variables">
     <a class="anchor" href="#_environment_variables">
     </a>
     Environment variables
    </h3>
    <div class="paragraph">
     <p>
      The environment trait is there to set environment variables on the container specification.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The environment trait provides the following configuration options:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           environment.vars
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            A list of environment variables to be added to the integration container. The syntax is KEY=VALUE, e.g.,
            <code>
             MY_VAR="my value"
            </code>
            . These take precedence over the previously defined environment variables.
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="paragraph">
     <p>
      The syntax to specify environment trait options is as follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait environment.[key]=[value]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      There is also a shortcut option
      <code>
       --env
      </code>
      that you can use.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --env [key]=[value]</code></pre>
     </div>
    </div>
    <div class="listingblock">
     <div class="title">
      Example
     </div>
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait environment.vars=MY_ENV=foo --env FOO_ENV=bar</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This results in the following container specification in the Deployment resource.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    camel.apache.org/integration: sample
  name: sample
spec:
  selector:
    matchLabels:
      camel.apache.org/integration: sample
  template:
    metadata:
      labels:
        camel.apache.org/integration: sample
    spec:
      containers:
      - image: quay.io/sample:1.0-SNAPSHOT
        name: sample
        env: <i class="conum" data-value="1"></i><b>(1)</b>
          - name: MY_ENV
            value: foo
          - name: FOO_ENV
            value: bar</code></pre>
     </div>
    </div>
    <div class="colist arabic">
     <div class="table-wrapper">
      <table>
       <tr>
        <td>
         <i class="conum" data-value="1">
         </i>
         <b>
          1
         </b>
        </td>
        <td>
         Environment variables set in the container specification
        </td>
       </tr>
      </table>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_service_trait_options">
     <a class="anchor" href="#_service_trait_options">
     </a>
     Service trait options
    </h3>
    <div class="paragraph">
     <p>
      The Service trait enhances the Kubernetes manifest with a Service resource so that the application can be accessed by other components in the same namespace. The service resource exposes the application with a protocol (e.g., TCP/IP) on a given port and uses either
      <code>
       ClusterIP
      </code>
      ,
      <code>
       NodePort
      </code>
      or
      <code>
       LoadBalancer
      </code>
      type.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Camel JBang plugin automatically inspects the Camel routes for exposed Http services and adds the service resource when applicable. This means when one of the Camel routes exposes a Http service (for instance by using the
      <code>
       platform-http
      </code>
      component) the Kubernetes manifest also creates a Kubernetes Service resource besides the arbitrary Deployment.
     </p>
    </div>
    <div class="paragraph">
     <p>
      You can customize the generated Kubernetes service resource with trait options:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           service.type
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The type of service to be used, either 'ClusterIP', 'NodePort' or 'LoadBalancer'.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.service-port
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           int
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure under which service port the container port is to be exposed (default
            <code>
             80
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           container.service-port-name
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure under which service port name the container port is to be exposed (default
            <code>
             http
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_knative_service_trait_options">
     <a class="anchor" href="#_knative_service_trait_options">
     </a>
     Knative service trait options
    </h3>
    <div class="paragraph">
     <p>
      <a href="https://knative.dev/docs/serving/">
       Knative serving
      </a>
      defines a set of resources on Kubernetes to handle Serverless workloads with automatic scaling and scale-to-zero functionality.
     </p>
    </div>
    <div class="paragraph">
     <p>
      When Knative serving is available on the target Kubernetes cluster, you may want to use the Knative service resource instead of an arbitrary Kubernetes service resource. The Knative service trait will create such a resource as part of the Kubernetes manifest.
     </p>
    </div>
    <div class="admonitionblock note">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-note" title="Note">
         </i>
        </td>
        <td class="content">
         The
         <code>
          knative-service
         </code>
         trait is disabled by default, you need to enable the Knative service trait with
         <code>
          --trait knative-service.enabled=true
         </code>
         option. Otherwise, the Camel JBang export will always create an arbitrary Kubernetes service resource.
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="admonitionblock note">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-note" title="Note">
         </i>
        </td>
        <td class="content">
         If you enable the knative-service trait and deploys to minikube and uses the docker builder to build the container image in the minikube registry addon, it’s likely the container image published won’t contain the digest value, and
         <a href="https://knative.dev/docs/serving/configuration/deployment/#skipping-tag-resolution">
          knative-serving has a verification to check the image digest
         </a>
         , so the pod will fail to start with the error message
         <code>
          failed to resolve image to digest
         </code>
         , so for development purposes the kubernetes plugin will skip this validation by adding the property
         <code>
          registries-skipping-tag-resolving: localhost:5000
         </code>
         to the
         <code>
          configmap/config-deployment
         </code>
         in
         <code>
          knative-serving
         </code>
         namespace, if you want to disable this automatic setting, you can set the
         <code>
          --disable-auto
         </code>
         parameter to disable the automatic cluster configuration, however disabling it won’t set other automatic configuration for the cluster. You may also want to manually set that property, so this plugin won’t set it even with the automatic cluster detection.
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="paragraph">
     <p>
      WARN: Currently knative-service doesn’t work in OpenShift, work is underway to fix it.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The trait offers following options for customization:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.enabled
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           bool
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Can be used to enable or disable a trait. All traits share this common property.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.annotations
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           map[string]string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The annotations added to route. This can be used to set knative service-specific annotations CLI usage example: -t "knative-service.annotations.'haproxy.router.openshift.io/balance'=true"
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.class
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Configures the Knative autoscaling class property (e.g., to set
            <code>
             hpa.autoscaling.knative.dev
            </code>
            or
            <code>
             kpa.autoscaling.knative.dev
            </code>
            autoscaling).
           </p>
          </div>
          <div class="paragraph">
           <p>
            Refer to the Knative documentation for more information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.autoscaling-metric
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Configures the Knative autoscaling metric property (e.g., to set
            <code>
             concurrency
            </code>
            based or
            <code>
             cpu
            </code>
            based autoscaling).
           </p>
          </div>
          <div class="paragraph">
           <p>
            Refer to the Knative documentation for more information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.autoscaling-target
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           int
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Sets the allowed concurrency level or CPU percentage (depending on the autoscaling metric) for each Pod.
           </p>
          </div>
          <div class="paragraph">
           <p>
            Refer to the Knative documentation for more information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.min-scale
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           int
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The minimum number of Pods that should be running at any time for the integration. It’s
            <strong>
             zero
            </strong>
            by default, meaning that the integration is scaled down to zero when not used for a configured amount of time.
           </p>
          </div>
          <div class="paragraph">
           <p>
            Refer to the Knative documentation for more information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.max-scale
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           int
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            An upper bound for the number of Pods that can be running in parallel for the integration. Knative has its own cap value that depends on the installation.
           </p>
          </div>
          <div class="paragraph">
           <p>
            Refer to the Knative documentation for more information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.rollout-duration
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Enables to gradually shift traffic to the latest Revision and sets the rollout duration. It’s disabled by default and must be expressed as a Golang
            <code>
             time.Duration
            </code>
            string representation, rounded to a second precision.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.visibility
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Setting
            <code>
             cluster-local
            </code>
            , Knative service becomes a private service. Specifically, this option applies the
            <code>
             networking.knative.dev/visibility
            </code>
            label to Knative service.
           </p>
          </div>
          <div class="paragraph">
           <p>
            Refer to the Knative documentation for more information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative-service.timeout-seconds
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           int
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The maximum duration in seconds that the request instance is allowed to respond to a request. This field propagates to the integration Pod’s terminationGracePeriodSeconds.
           </p>
          </div>
          <div class="paragraph">
           <p>
            Refer to the Knative documentation for more information.
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_connecting_to_knative">
     <a class="anchor" href="#_connecting_to_knative">
     </a>
     Connecting to Knative
    </h3>
    <div class="paragraph">
     <p>
      The previous section described how the exported Apache Camel application can leverage the Knative service resource with auto-scaling as part of the deployment to Kubernetes.
     </p>
    </div>
    <div class="paragraph">
     <p>
      Apache Camel also provides a Knative component that makes you easily interact with
      <a href="https://knative.dev/docs/eventing/">
       Knative eventing
      </a>
      and
      <a href="https://knative.dev/docs/serving/">
       Knative serving
      </a>
      .
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Knative component enables you to exchange data with the Knative eventing broker and other Knative services deployed on Kubernetes. The Camel JBang Kubernetes plugin provides some autoconfiguration options when connecting with the Knative component. The export command assists you in configuring both the Knative component and the Kubernetes manifest for connecting to Knative resources on the Kubernetes cluster.
     </p>
    </div>
    <div class="paragraph">
     <p>
      You can configure the Knative component with the Knative trait.
     </p>
    </div>
    <div class="admonitionblock note">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-note" title="Note">
         </i>
        </td>
        <td class="content">
         The
         <code>
          knative
         </code>
         trait is disabled by default, you need to enable the Knative trait with
         <code>
          --trait knative.enabled=true
         </code>
         option.
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The trait offers the following options for customization:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.enabled
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           bool
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Can be used to enable or disable a trait. (default: true)
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.configuration
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Can be used to inject a Knative complete configuration in JSON format
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.channel-sinks
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            List of channels used as destination of camel routes. Can contain simple channel names or full Camel URIs.
           </p>
          </div>
          <div class="paragraph">
           <p>
            Refer to the Knative documentation for more information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.channel-sources
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            List of channels used as the source of camel routes. Can contain simple channel names or full Camel URIs.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.endpoint-sinks
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            List of endpoints used as destination of camel routes. Can contain simple endpoint names or full Camel URIs.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.endpoint-sources
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            List of endpoints used as sources of camel routes. Can contain simple endpoint names or full Camel URIs.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.event-sinks
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            List of endpoints used as destination of integration routes. Can contain simple endpoint names or full Camel URIs.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.event-sources
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            List of event types that the integration will be subscribed to. Can contain simple event types or full Camel URIs (to use a specific broker different from "default").
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.sink-binding
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           bool
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Allows binding the integration to a sink via a Knative SinkBinding resource. This can be used when the integration targets a single sink. It’s enabled by default when the integration targets a single sink (except when the integration is owned by a Knative source).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.filters
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Sets filter attributes on the event stream (such as event type, source, subject and so on). A list of key-value pairs that represent filter attributes and its values. The syntax is KEY=VALUE, e.g., source="my.source". Filter attributes get set on the Knative trigger that is being created as part of this integration.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           knative.filter-event-type
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           bool
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Enables the default filtering for the Knative trigger using the event type If this is true, the created Knative trigger uses the event type as a filter on the event stream when no other filter criteria is given. (default: true)
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_knative_trigger">
     <a class="anchor" href="#_knative_trigger">
     </a>
     Knative trigger
    </h3>
    <div class="paragraph">
     <p>
      The concept of a Knative trigger allows you to consume events from the
      <a href="https://knative.dev/docs/eventing/">
       Knative eventing
      </a>
      broker. In case your Camel route uses the Knative component as a consumer you may need to create a trigger in Kubernetes to connect your Camel application with the Knative broker.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Camel JBang Kubernetes plugin is able to automatically create this trigger for you.
     </p>
    </div>
    <div class="admonitionblock note">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-note" title="Note">
         </i>
        </td>
        <td class="content">
         The
         <code>
          knative
         </code>
         trait is disabled by default, you need to enable the Knative trait with
         <code>
          --trait knative.enabled=true
         </code>
         option.
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The following Camel route uses the Knative event component and references a Knative broker by its name. The plugin inspects the code and automatically generates the Knative trigger as part of the Kubernetes manifest that is used to run the Camel application on Kubernetes.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- from:
    uri: knative:event/camel.evt.type?name=my-broker
    steps:
      - to: log:info</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The route consumes Knative events of type
      <code>
       camel.evt.type
      </code>
      . If you export this route with the Camel JBang Kubernetes plugin, you will see a Knative trigger being generated as part of the Kubernetes manifest (kubernetes.yml).
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export knative-route.yaml</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The generated export project can be deployed to Kubernetes, and as part of the deployment, the trigger is automatically created so the application can start consuming events.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The generated trigger looks as follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  name: my-broker-knative-route-camel-evt-type
spec:
  broker: my-broker
  filter:
    attributes:
      type: camel.evt.type
  subscriber:
    ref:
      apiVersion: v1
      kind: Service
      name: knative-route
    uri: /events/camel-evt-type</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The trigger uses a default filter on the event type CloudEvents attribute and calls the Camel application via the exposed Kubernetes service resource.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Camel application is automatically configured to expose an Http service so incoming events are handed over to the Camel route. You can review the Knative service resource configuration that makes Camel configure the Knative component. The configuration has been automatically created in
      <code>
       src/main/resources/knative.json
      </code>
      in the exported project.
     </p>
    </div>
    <div class="paragraph">
     <p>
      Here is an example of the generated
      <code>
       knative.json
      </code>
      file:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "resources" : [ {
    "name" : "camel-event",
    "type" : "event",
    "endpointKind" : "source",
    "path" : "/events/camel-event",
    "objectApiVersion" : "eventing.knative.dev/v1",
    "objectKind" : "Broker",
    "objectName" : "my-broker",
    "reply" : false
  } ]
}</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The exported project has everything configured to run the application on Kubernetes. Of course, you need Knative eventing installed on your target cluster, and you need to have a Knative broker named
      <code>
       my-broker
      </code>
      available in the target namespace.
     </p>
    </div>
    <div class="paragraph">
     <p>
      Now you can just deploy the application using the Kubernetes manifest and see the Camel route consuming events from the broker.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_knative_channel_subscription">
     <a class="anchor" href="#_knative_channel_subscription">
     </a>
     Knative channel subscription
    </h3>
    <div class="paragraph">
     <p>
      Knative channels represent another form of producing and consuming events from the Knative broker. Instead of using a trigger, you can create a subscription for a Knative channel to consume events.
     </p>
    </div>
    <div class="admonitionblock note">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-note" title="Note">
         </i>
        </td>
        <td class="content">
         The
         <code>
          knative
         </code>
         trait is disabled by default, you need to enable the Knative trait with
         <code>
          --trait knative.enabled=true
         </code>
         option.
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The Camel route that connects to a Knative channel in order to receive events looks like this:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- from:
    uri: knative:channel/my-channel
    steps:
      - to: log:info</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The Knative channel is referenced by its name. The Camel JBang Kubernetes plugin will inspect your code to automatically create a channel subscription as part of the Kubernetes manifest. You just need to export the Camel route as usual.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export knative-route.yaml</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The code inspection recognizes the Knative component that references the Knative channel, and the subscription automatically becomes part of the exported Kubernetes manifest.
     </p>
    </div>
    <div class="paragraph">
     <p>
      Here is an example subscription that has been generated during the export:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: messaging.knative.dev/v1
kind: Subscription
metadata:
  name: my-channel-knative-route
spec:
  channel:
    apiVersion: messaging.knative.dev/v1
    kind: Channel
    name: my-channel
  subscriber:
    ref:
      apiVersion: v1
      kind: Service
      name: knative-route
    uri: /channels/my-channel</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The subscription connects the Camel application with the channel, so each event on the channel is sent to the Kubernetes service resource that also has been created as part of the Kubernetes manifest.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Camel Knative component uses a service resource configuration internally to create the proper Http service. You can review the Knative service resource configuration that makes Camel configure the Knative component. The configuration has been automatically created in
      <code>
       src/main/resources/knative.json
      </code>
      in the exported project.
     </p>
    </div>
    <div class="paragraph">
     <p>
      Here is an example of the generated
      <code>
       knative.json
      </code>
      file:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "resources" : [ {
    "name" : "my-channel",
    "type" : "channel",
    "endpointKind" : "source",
    "path" : "/channels/my-channel",
    "objectApiVersion" : "messaging.knative.dev/v1",
    "objectKind" : "Channel",
    "objectName" : "my-channel",
    "reply" : false
  } ]
}</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      Assuming that you have Knative eventing installed on your cluster and that you have set up the Knative channel
      <code>
       my-channel
      </code>
      you can start consuming events right away. The deployment of the exported project uses the Kubernetes manifest to create all required resources, including the Knative subscription.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_knative_sink_binding">
     <a class="anchor" href="#_knative_sink_binding">
     </a>
     Knative sink binding
    </h3>
    <div class="paragraph">
     <p>
      When connecting to a Knative resource (Broker, Channel, Service) in order to produce events for Knative eventing you probably want to use a
      <code>
       SinkBinding
      </code>
      that resolves the URL to the Knative resource for you. The sink binding is a Kubernetes resource that makes Knative eventing automatically inject the resource URL into your Camel application on startup. The Knative URL injection uses environment variables (
      <code>
       K_SINK
      </code>
      ,
      <code>
       K_CE_OVERRIDES
      </code>
      ) on your deployment. The Knative eventing operator will automatically resolve the Knative resource (e.g. a Knative broker URL) and inject the value so your application does not need to know the actual URL when deploying.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Camel JBang Kubernetes plugin leverages the sink binding concept for all routes that use the Knative component as an output.
     </p>
    </div>
    <div class="admonitionblock note">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-note" title="Note">
         </i>
        </td>
        <td class="content">
         The
         <code>
          knative
         </code>
         trait is disabled by default, you need to enable the Knative trait with
         <code>
          --trait knative.enabled=true
         </code>
         option.
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The following route produces events on a Knative broker:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- from:
    uri: timer:tick
    steps:
      - setBody:
          constant: Hello Camel !!!
      - to: knative:event/camel.evt.type?name=my-broker</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The route produces events of type
      <code>
       camel.evt.type
      </code>
      and pushes the events to the broker named
      <code>
       my-broker
      </code>
      . At this point, the actual Knative broker URL is unknown. The sink binding is going to resolve the URL and inject its value at deployment time using the
      <code>
       K_SINK
      </code>
      environment variable.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Camel JBang Kubernetes plugin export automatically inspects such a route and automatically creates the sink binding resource for us. The sink binding is part of the exported Kubernetes manifest and is created on the cluster as part of the deployment.
     </p>
    </div>
    <div class="paragraph">
     <p>
      A sink binding resource created by the export command looks like follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export knative-route.yaml</code></pre>
     </div>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: SinkBinding
metadata:
  finalizers:
    - sinkbindings.sources.knative.dev
  name: knative-route
spec:
  sink:
    ref:
      apiVersion: eventing.knative.dev/v1
      kind: Broker
      name: my-broker
  subject:
    apiVersion: apps/v1
    kind: Deployment
    name: knative-route</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      In addition to creating the sink binding, the Camel JBang plugin also takes care of configuring the Knative Camel component. The Knative component uses a configuration file that you can find in
      <code>
       src/main/resources/knative.json
      </code>
      . As you can see the configuration uses the
      <code>
       K_SINK
      </code>
      injected property placeholder as a broker URL.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "resources" : [ {
    "name" : "camel-evt-type",
    "type" : "event",
    "endpointKind" : "sink",
    "url" : "{{k.sink}}",
    "objectApiVersion" : "eventing.knative.dev/v1",
    "objectKind" : "Broker",
    "objectName" : "my-broker",
    "reply" : false
  } ]
}</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      As soon as the Kubernetes deployment for the exported project has started the sink binding will inject the
      <code>
       K_SINK
      </code>
      environment variable so that the Camel applicaiton is ready to send events to the Knative broker.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The sink binding concept works for Knative Broker, Channel and Service resources. You just reference the resource by its name in your Camel route when sending data to the Knative component as an output of the route (
      <code>
       to("knative:event|channel|endpoint/&lt;resource-name&gt;")
      </code>
      ).
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_mount_trait_options">
     <a class="anchor" href="#_mount_trait_options">
     </a>
     Mount trait options
    </h3>
    <div class="paragraph">
     <p>
      The mount trait is able to configure volume mounts on the Deployment resource in order to inject data from Kubernetes resources such as config maps or secrets.
     </p>
    </div>
    <div class="paragraph">
     <p>
      There are also shortcut options like
      <code>
       --volume
      </code>
      ,
      <code>
       --config
      </code>
      and
      <code>
       --resource
      </code>
      for the mount trait. These options are described in more detail in the next section. For now let’s have a look into the pure mount trait configuration options.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The mount trait provides the following configuration options:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           mount.configs
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            A list of configuration pointing to configmap/secret. The configurations are expected to be UTF-8 resources as they are processed by runtime Camel Context and tried to be parsed as property files. They are also made available on the classpath to ease their usage directly from the Route. Syntax: [configmap|secret]:name[/key], where name represents the resource name and key optionally represents the resource key to be filtered
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           mount.resources
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            A list of resources (text or binary content) pointing to a configmap/secret. The resources are expected to be any resource type (text or binary content). The destination path can be either a default location or any path specified by the user. Syntax: [configmap|secret]:name[/key][@path], where name represents the resource name, key optionally represents the resource key to be filtered and path represents the destination path
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           mount.volumes
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            A list of Persistent Volume Claims to be mounted. Syntax: [pvcname:/container/path]
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="paragraph">
     <p>
      The syntax to specify mount trait options is as follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait mount.[key]=[value]</code></pre>
     </div>
    </div>
    <div class="listingblock">
     <div class="title">
      Example
     </div>
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait mount.configs=configmap:my-data --trait mount.volumes=my-pvc:/container/path</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This results in the following container specification in the Deployment resource.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    camel.apache.org/integration: sample
  name: sample
spec:
  selector:
    matchLabels:
      camel.apache.org/integration: sample
  template:
    metadata:
      labels:
        camel.apache.org/integration: sample
    spec:
      containers:
        - image: quay.io/sample:1.0-SNAPSHOT
          name: sample
          volumeMounts:
            - mountPath: /etc/camel/conf.d/_configmaps/my-data <i class="conum" data-value="1"></i><b>(1)</b>
              name: my-data
              readOnly: true
            - mountPath: /container/path <i class="conum" data-value="2"></i><b>(2)</b>
              name: my-pvc
              readOnly: false
      volumes:
        - name: my-data <i class="conum" data-value="3"></i><b>(3)</b>
          configMap:
            name: my-data
        - name: my-pvc <i class="conum" data-value="4"></i><b>(4)</b>
          persistentVolumeClaim:
            claimName: my-pvc</code></pre>
     </div>
    </div>
    <div class="colist arabic">
     <div class="table-wrapper">
      <table>
       <tr>
        <td>
         <i class="conum" data-value="1">
         </i>
         <b>
          1
         </b>
        </td>
        <td>
         The config map
         <code>
          my-data
         </code>
         mounted into the container with default mount path for configurations
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="2">
         </i>
         <b>
          2
         </b>
        </td>
        <td>
         The volume mounted into the container with given path
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="3">
         </i>
         <b>
          3
         </b>
        </td>
        <td>
         The config map reference as volume spec
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="4">
         </i>
         <b>
          4
         </b>
        </td>
        <td>
         The persistent volume claim
         <code>
          my-pvc
         </code>
        </td>
       </tr>
      </table>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_configmaps_volumes_and_secrets">
     <a class="anchor" href="#_configmaps_volumes_and_secrets">
     </a>
     ConfigMaps, volumes and secrets
    </h3>
    <div class="paragraph">
     <p>
      In the previous section, we have seen how to mount volumes, configs, and resources into the container.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Kubernetes export command provides some shortcut options for adding configmaps and secrets as volume mounts. The syntax is as follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --config [key]=[value] --resource [key]=[value] --volume [key]=[value]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The options expect the following syntax:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Option
        </th>
        <th class="tableblock halign-left valign-top">
         Syntax
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           config
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Add a runtime configuration from a ConfigMap or a Secret (syntax: [configmap|secret]:name[/key], where name represents the configmap or secret name and key optionally represents the configmap or secret key to be filtered).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           resource
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Add a runtime resource from a Configmap or a Secret (syntax: [configmap|secret]:name[/key][@path], where name represents the configmap or secret name, key optionally represents the configmap or secret key to be filtered and the path represents the destination path).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           volume
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Mount a volume into the integration container, for instance "--volume pvcname:/container/path".
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="listingblock">
     <div class="title">
      Example
     </div>
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --config secret:my-credentials  --resource configmap:my-data --volume my-pvc:/container/path</code></pre>
     </div>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    camel.apache.org/integration: sample
  name: sample
spec:
  selector:
    matchLabels:
      camel.apache.org/integration: sample
  template:
    metadata:
      labels:
        camel.apache.org/integration: sample
    spec:
      containers:
        - image: quay.io/sample:1.0-SNAPSHOT
          name: sample
          volumeMounts:
            - mountPath: /etc/camel/conf.d/_secrets/my-credentials
              name: my-credentials <i class="conum" data-value="1"></i><b>(1)</b>
              readOnly: true
            - mountPath: /etc/camel/resources.d/_configmaps/my-data
              name: my-data <i class="conum" data-value="2"></i><b>(2)</b>
              readOnly: true
            - mountPath: /container/path
              name: my-pvc <i class="conum" data-value="3"></i><b>(3)</b>
              readOnly: false
      volumes:
        - name: my-credentials <i class="conum" data-value="4"></i><b>(4)</b>
          secret:
            secretName: my-credentials
        - name: my-data <i class="conum" data-value="5"></i><b>(5)</b>
          configMap:
            name: my-data
        - name: my-pvc <i class="conum" data-value="6"></i><b>(6)</b>
          persistentVolumeClaim:
            claimName: my-pvc</code></pre>
     </div>
    </div>
    <div class="colist arabic">
     <div class="table-wrapper">
      <table>
       <tr>
        <td>
         <i class="conum" data-value="1">
         </i>
         <b>
          1
         </b>
        </td>
        <td>
         The secret configuration volume mount
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="2">
         </i>
         <b>
          2
         </b>
        </td>
        <td>
         The config map resource volume mount
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="3">
         </i>
         <b>
          3
         </b>
        </td>
        <td>
         The volume mount
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="4">
         </i>
         <b>
          4
         </b>
        </td>
        <td>
         The secret configuration volume
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="5">
         </i>
         <b>
          5
         </b>
        </td>
        <td>
         The config map resource volume
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="6">
         </i>
         <b>
          6
         </b>
        </td>
        <td>
         The persistent volume claim volume
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="paragraph">
     <p>
      The trait volume mounts follow some best practices in specifying the mount paths in the container. Configurations and resources, secrets, and configmaps do use different paths in the container. The Camel application is automatically configured to read these paths as resource folders, so you can use the mounted data in the Camel routes via classpath reference, for instance.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_ingress_trait_options">
     <a class="anchor" href="#_ingress_trait_options">
     </a>
     Ingress trait options
    </h3>
    <div class="paragraph">
     <p>
      The ingress trait enhances the Kubernetes manifest with an Ingress resource to expose the application to the outside world. This requires the presence in the Kubernetes manifest of a Service Resource.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The ingress trait provides the following configuration options:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           ingress.enabled
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           bool
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Can be used to enable or disable a trait. All traits share this common property (default
            <code>
             false
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           ingress.annotations
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           map[string]string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The annotations added to the ingress. This can be used to set controller-specific annotations, e.g., when using the
            <a href="https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md">
             NGINX Ingress controller
            </a>
            .
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           ingress.host
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure the host exposed by the ingress.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           ingress.path
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure the path exposed by the ingress (default
            <code>
             /
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           ingress.pathType
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure the
            <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#path-types">
             path type
            </a>
            exposed by the ingress. One of Exact, Prefix, ImplementationSpecific (default to Prefix).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           ingress.auto
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           bool
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To automatically add an Ingress Resource whenever the route uses an HTTP endpoint consumer (default
            <code>
             true
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           ingress.tls-hosts
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure specific hosts exposed through SNI TLS extension by the ingess.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           ingress.tls-secret-name
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To indicate the secret containing the TLS private key and certificate to use for TLS.
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="paragraph">
     <p>
      The syntax to specify container trait options is as follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait ingress.[key]=[value]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      You may specify these options with the export command to customize the Ingress Resource specification.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait ingress.enabled=true --trait ingress.host=example.com --trait ingress.path=/sample(/|$)(.*) --trait ingress.pathType=ImplementationSpecific --trait ingress.annotations=nginx.ingress.kubernetes.io/rewrite-target=/\$2 --trait ingress.annotations=nginx.ingress.kubernetes.io/use-regex=true</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This results in the following container specification in the Ingress resource.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations: <i class="conum" data-value="1"></i><b>(1)</b>
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.ingress.kubernetes.io/use-regex: "true"
  labels:
    app.kubernetes.io/name: sample
  name: sample
spec:
  ingressClassName: nginx
  rules:
  - host: example.com
    http:
      paths:
      - backend:
          service:
            name: route-service
            port:
              name: http <i class="conum" data-value="2"></i><b>(2)</b>
        path: /sample(/|$)(.*) <i class="conum" data-value="3"></i><b>(3)</b>
        pathType: ImplementationSpecific <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
     </div>
    </div>
    <div class="colist arabic">
     <div class="table-wrapper">
      <table>
       <tr>
        <td>
         <i class="conum" data-value="1">
         </i>
         <b>
          1
         </b>
        </td>
        <td>
         Custom annotations configuration for ingress behavior
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="2">
         </i>
         <b>
          2
         </b>
        </td>
        <td>
         Service port name
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="3">
         </i>
         <b>
          3
         </b>
        </td>
        <td>
         Custom ingress backend path
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="4">
         </i>
         <b>
          4
         </b>
        </td>
        <td>
         Custom ingress backend path type
        </td>
       </tr>
      </table>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_route_trait_options">
     <a class="anchor" href="#_route_trait_options">
     </a>
     Route trait options
    </h3>
    <div class="paragraph">
     <p>
      The Route trait enhances the Kubernetes manifest with a Route resource to expose the application to the outside world. This requires the presence in the Kubernetes manifest of a Service Resource.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The Route trait provides the following configuration options:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.enabled
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           bool
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            Can be used to enable or disable a trait. All traits share this common property (default
            <code>
             false
            </code>
            ).
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.annotations
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           map[string]string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The annotations added to the route. This can be used to set
            <a href="https://docs.openshift.com/container-platform/4.16/networking/routes/route-configuration.html#nw-route-specific-annotations_route-configuration">
             openshift route specific annotations
            </a>
            options.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.host
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure the host exposed by the route.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.tls-termination
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The TLS termination type, like
            <code>
             edge
            </code>
            ,
            <code>
             passthrough
            </code>
            or
            <code>
             reencrypt
            </code>
            . Refer to the OpenShift route documentation for additional information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.tls-certificate
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The TLS certificate contents or file (
            <code>
             file:absolute.path
            </code>
            ). Refer to the OpenShift route documentation for additional information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.tls-key
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The TLS certificate key contents or file (
            <code>
             file:absolute.path
            </code>
            ). Refer to the OpenShift route documentation for additional information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.tls-ca-certificate
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The TLS CA certificate contents or file (
            <code>
             file:absolute.path
            </code>
            ). Refer to the OpenShift route documentation for additional information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.tls-destination-ca-certificate
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The destination CA contents or file (
            <code>
             file:absolute.path
            </code>
            ). The destination CA certificate provides the contents of the CA certificate of the final destination. When using reencrypt termination, this file should be provided to have routers use it for health checks on the secure connection. If this field is not specified, the router may provide its own destination CA and perform hostname validation using the short service name (service.namespace.svc), which allows infrastructure generated certificates to automatically verify. Refer to the OpenShift route documentation for additional information.
           </p>
          </div>
         </div>
        </td>
       </tr>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           route.tls-insecure-edge-termination-policy
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            To configure how to deal with insecure traffic, e.g.
            <code>
             Allow
            </code>
            ,
            <code>
             Disable
            </code>
            or
            <code>
             Redirect
            </code>
            traffic. Refer to the OpenShift route documentation for additional information.
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="paragraph">
     <p>
      The syntax to specify container trait options is as follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait route.[key]=[value]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      You may specify these options with the export command to customize the Route Resource specification.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --cluster-type=openshift -t route.enabled=true --trait route.host=example.com -t route.tls-termination=edge -t route.tls-certificate=file:/tmp/tls.crt -t route.tls-key=file:/tmp/tls.key</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This results in the following container specification in the Route resource.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: route.openshift.io/v1
kind: Route
metadata:
  name: route-service
spec:
  host: example.com <i class="conum" data-value="1"></i><b>(1)</b>
  port:
    targetPort: http <i class="conum" data-value="2"></i><b>(2)</b>
  tls:
    certificate: | <i class="conum" data-value="3"></i><b>(3)</b>
      ...
    key: | <i class="conum" data-value="4"></i><b>(4)</b>
      ...
    termination: edge <i class="conum" data-value="5"></i><b>(5)</b>
  to: <i class="conum" data-value="6"></i><b>(6)</b>
    kind: Service
    name: route-service</code></pre>
     </div>
    </div>
    <div class="colist arabic">
     <div class="table-wrapper">
      <table>
       <tr>
        <td>
         <i class="conum" data-value="1">
         </i>
         <b>
          1
         </b>
        </td>
        <td>
         Custom route host
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="2">
         </i>
         <b>
          2
         </b>
        </td>
        <td>
         Service port name
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="3">
         </i>
         <b>
          3
         </b>
        </td>
        <td>
         Custom route TLS certificate content
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="4">
         </i>
         <b>
          4
         </b>
        </td>
        <td>
         Custom route TLS certificate key content
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="5">
         </i>
         <b>
          5
         </b>
        </td>
        <td>
         Custom route TLS termination
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="6">
         </i>
         <b>
          6
         </b>
        </td>
        <td>
         Service Resource reference
        </td>
       </tr>
      </table>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_openapi_specifications">
     <a class="anchor" href="#_openapi_specifications">
     </a>
     OpenApi specifications
    </h3>
    <div class="paragraph">
     <p>
      You can mount OpenAPI specifications to the application container with this trait.
     </p>
    </div>
    <div class="paragraph">
     <p>
      The openapi trait provides the following configuration options:
     </p>
    </div>
    <div class="table-wrapper">
     <table class="tableblock frame-all grid-all stretch">
      <colgroup>
       <col/>
       <col/>
       <col/>
      </colgroup>
      <thead>
       <tr>
        <th class="tableblock halign-left valign-top">
         Property
        </th>
        <th class="tableblock halign-left valign-top">
         Type
        </th>
        <th class="tableblock halign-left valign-top">
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           openapi.configmaps
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <p class="tableblock">
          <code>
           []string
          </code>
         </p>
        </td>
        <td class="tableblock halign-left valign-top">
         <div class="content">
          <div class="paragraph">
           <p>
            The configmaps holding the spec of the OpenAPI
           </p>
          </div>
         </div>
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <div class="paragraph">
     <p>
      The syntax to specify openapi trait options is as follows:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait openapi.[key]=[value]</code></pre>
     </div>
    </div>
    <div class="listingblock">
     <div class="title">
      Example
     </div>
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --trait openapi.configmaps=configmap:my-spec</code></pre>
     </div>
    </div>
    <div class="admonitionblock tip">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-tip" title="Tip">
         </i>
        </td>
        <td class="content">
         There is also a shortcut option
         <code>
          --open-api=configmap:my-configmap
         </code>
         .
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes export Sample.java --open-api configmap:[name-of-configmap]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This results in the following container specification in the Deployment resource.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    camel.apache.org/integration: sample
  name: sample
spec:
  selector:
    matchLabels:
      camel.apache.org/integration: sample
  template:
    metadata:
      labels:
        camel.apache.org/integration: sample
    spec:
      containers:
      - image: quay.io/sample:1.0-SNAPSHOT
        name: sample
        volumeMounts:
            - mountPath: /etc/camel/resources.d/_configmaps/my-spec
              name: my-spec <i class="conum" data-value="1"></i><b>(1)</b>
              readOnly: true
      volumes:
        - name: my-spec <i class="conum" data-value="2"></i><b>(2)</b>
          configMap:
            name: my-spec</code></pre>
     </div>
    </div>
    <div class="colist arabic">
     <div class="table-wrapper">
      <table>
       <tr>
        <td>
         <i class="conum" data-value="1">
         </i>
         <b>
          1
         </b>
        </td>
        <td>
         OpenAPI specification volume mount
        </td>
       </tr>
       <tr>
        <td>
         <i class="conum" data-value="2">
         </i>
         <b>
          2
         </b>
        </td>
        <td>
         Volume referencing the config map holding the OpenAPI specification
        </td>
       </tr>
      </table>
     </div>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_deploy_to_openshift">
   <a class="anchor" href="#_deploy_to_openshift">
   </a>
   Deploy to OpenShift
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     By default, the Kubernetes manifest is suited for plain Kubernetes platforms. In case you are targeting OpenShift as a platform you may want to leverage special resources such as Route, ImageStream or BuildConfig.
    </p>
   </div>
   <div class="paragraph">
    <p>
     You can set the
     <code>
      cluster-type=openshift
     </code>
     option on the export command to tell the Kubernetes plugin to create a Kubernetes manifest specifically suited for OpenShift.
    </p>
   </div>
   <div class="paragraph">
    <p>
     Also, the default image builder is S2I for OpenShift clusters. This means by setting the cluster type, you will automatically switch from default Jib to S2I. Of course, you can tell the plugin to use Jib with
     <code>
      --image-builder=jib
     </code>
     option. The image may then get pushed to an external registry (docker.io or quay.io) so OpenShift can pull as part of the deployment in the cluster.
    </p>
   </div>
   <div class="admonitionblock tip">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-tip" title="Tip">
        </i>
       </td>
       <td class="content">
        When using S2I, you may need to explicitly set the
        <code>
         --image-group
        </code>
        option to the project/namespace name in the OpenShift cluster. This is because S2I will push the container image to an image repository that uses the OpenShift project/namespace name as part of the image coordinates in the registry:
        <code>
         image-registry.openshift-image-registry.svc:5000/&lt;project name&gt;/&lt;name&gt;:&lt;tag&gt;
        </code>
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="paragraph">
    <p>
     When using S2I as an image build option, the Kubernetes manifest also contains an ImageStream and BuildConfig resource. Both resources are automatically added/removed when creating/deleting the deployment with the Camel Kubernetes JBang plugin.
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_kubernetes_run">
   <a class="anchor" href="#_kubernetes_run">
   </a>
   Kubernetes run
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The run command combines several steps into one single command. The command performs a project export to a temporary folder, builds the project artifacts as well as the container images, pushes the image to an image registry and finally performs the deployment to Kubernetes using the generated Kubernetes manifest (
     <code>
      kubernetes.yml
     </code>
     ).
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes run route.yaml --image-registry=kind</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     When connecting to a local Kubernetes cluster, you may need to specify the image registry where the application container image gets pushed to. The run command is able to automatically configure the local registry when using predefined names such as
     <code>
      kind
     </code>
     or
     <code>
      minikube
     </code>
     , there is a detection mechanism to set some properties accordingly to the cluster type, currently it can auto detect Openshift and Minikube. If you want to disable the cluster detection, you have to set the
     <code>
      --disable-auto
     </code>
     cli parameter.
    </p>
   </div>
   <div class="admonitionblock note">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-note" title="Note">
        </i>
       </td>
       <td class="content">
        When running minikube, the easiest way to push the image to the minikube container registry, is to enable the registry addon in minikube and to run
        <code>
         eval $(minikube docker-env)
        </code>
        .
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="paragraph">
    <p>
     Use the
     <code>
      --image-group
     </code>
     or the
     <code>
      --image
     </code>
     option to customize the container image.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes run route.yaml --image-registry=kind --image-group camel-experts</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     The command above builds and pushes the container image:
     <code>
      localhost:5001/camel-experts/route:1.0-SNAPSHOT
     </code>
     .
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes run route.yaml --image quay.io/camel-experts/demo-app:1.0</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     The
     <code>
      --image
     </code>
     option forces the container image group, name, version as well as the image registry.
    </p>
   </div>
   <div class="sect2">
    <h3 id="_customize_the_kubernetes_manifest">
     <a class="anchor" href="#_customize_the_kubernetes_manifest">
     </a>
     Customize the Kubernetes manifest
    </h3>
    <div class="paragraph">
     <p>
      The
      <code>
       run
      </code>
      command provides the same options to customize the Kubernetes manifest as the
      <code>
       export
      </code>
      command. You may want to add environment variables, mount secrets and configmaps, adjust the exposed service and many other things with trait options as described in the export command section.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_auto_reload_with_dev_option">
     <a class="anchor" href="#_auto_reload_with_dev_option">
     </a>
     Auto reload with
     <code>
      --dev
     </code>
     option
    </h3>
    <div class="paragraph">
     <p>
      The
      <code>
       --dev
      </code>
      option runs the application on Kubernetes and automatically adds a file watcher to listen for changes on the Camel route source files. In case the sources get changed, the process will automatically perform a rebuild and redeployment. The command constantly prints the logs to the output, so you may see the changes directly being applied to the Kubernetes deployment.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes run route.yaml --image-registry=kind --dev</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      You need to terminate the process to stop the dev mode. This automatically removes the Kubernetes deployment from the cluster on shutdown.
     </p>
    </div>
    <div class="admonitionblock note">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-note" title="Note">
         </i>
        </td>
        <td class="content">
         On macOS hosts, the file watch mechanism is known to be much slower and less stable compared to using the
         <code>
          --dev
         </code>
         option on other operating systems like Linux. This is due to limited native file operations on macOS for Java processes.
        </td>
       </tr>
      </table>
     </div>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_show_logs">
   <a class="anchor" href="#_show_logs">
   </a>
   Show logs
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     To inspect the log output of a running deployment call:
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes logs --name=route</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     The command connects to the running integration Pod on the cluster and streams the log output. Just terminate the process to stop printing the logs.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The
     <code>
      --name
     </code>
     option should point to a previously exported project (either via
     <code>
      run
     </code>
     or
     <code>
      export
     </code>
     command).
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_delete_deployments">
   <a class="anchor" href="#_delete_deployments">
   </a>
   Delete deployments
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     Of course, you may also delete a deployment from the cluster.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes delete --name=route</code></pre>
    </div>
   </div>
   <div class="paragraph">
    <p>
     Use the
     <code>
      --name
     </code>
     option to select a previously exported project (either via
     <code>
      run
     </code>
     or
     <code>
      export
     </code>
     command). The delete operation will remove all resources defined in the Kubernetes manifest.
    </p>
   </div>
   <div class="paragraph">
    <p>
     If you used the
     <code>
      --cluster-type
     </code>
     option to create your project (either via
     <code>
      run
     </code>
     or
     <code>
      export
     </code>
     command) you will need to use it as well for the delete operation.
    </p>
   </div>
   <div class="listingblock">
    <div class="content">
     <pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">camel kubernetes delete --name=route --cluster-type=openshift</code></pre>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_minikube_deployment_tips_and_troubleshooting">
   <a class="anchor" href="#_minikube_deployment_tips_and_troubleshooting">
   </a>
   Minikube deployment tips and troubleshooting
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     To run a local Kubernetes cluster with Minikube for development purposes. Here are some tips from users that have been using this.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The following steps have been known to be working with Camel 4.8.1+:
    </p>
   </div>
   <div class="olist arabic">
    <ol class="arabic">
     <li>
      <p>
       <code>
        minikube start --addons registry --driver=docker
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        eval $(minikube -p minikube docker-env)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        camel kubernetes run demo.camel.yaml --cluster-type=minikube --build-property=quarkus.kubernetes.image-pull-policy=Never
       </code>
      </p>
     </li>
    </ol>
   </div>
   <div class="paragraph">
    <p>
     Most important
     <code>
      --build-property=quarkus.kubernetes.image-pull-policy=Never
     </code>
     without that it is not working, which is not clear from the current Minikube docs.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The following steps have been known to be working with Camel 4.9+:
    </p>
   </div>
   <div class="olist arabic">
    <ol class="arabic">
     <li>
      <p>
       <code>
        minikube start --addons registry --driver=docker
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        eval $(minikube -p minikube docker-env)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        camel kubernetes run demo.camel.yaml --cluster-type=minikube --build-property=quarkus.kubernetes.image-pull-policy=Never --trait container.image-push=true --image-registry '$(kubectl -n kube-system get service registry -o jsonpath='{.spec.clusterIP}')' --image-builder=docker
       </code>
      </p>
     </li>
    </ol>
   </div>
   <div class="paragraph">
    <p>
     The following steps have been known to be working with Camel 4.10+:
    </p>
   </div>
   <div class="olist arabic">
    <ol class="arabic">
     <li>
      <p>
       <code>
        minikube start --addons registry --driver=docker
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        eval $(minikube -p minikube docker-env)
       </code>
      </p>
     </li>
     <li>
      <p>
       <code>
        camel kubernetes run demo.camel.yaml --cluster-type=minikube --build-property=quarkus.kubernetes.image-pull-policy=Never --image-registry "$(kubectl -n kube-system get service registry -o jsonpath='{.spec.clusterIP}')" --image-builder=docker
       </code>
      </p>
     </li>
    </ol>
   </div>
   <div class="paragraph">
    <p>
     Note that Docker multi-platform build is used. It requires to have followed these
     <a href="https://docs.docker.com/build/building/multi-platform/#build-multi-platform-images">
      Docker requirements
     </a>
     .
    </p>
   </div>
  </div>
 </div>
</article>
