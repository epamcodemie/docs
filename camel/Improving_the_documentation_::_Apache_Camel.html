<article class="doc">
 <h1 class="page">
  Improving the documentation
 </h1>
 <div id="preamble">
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     The Apache Camel project loves your help with improving the documentation, whether its a tiny typo fix, or adding more details to an existing component, etc.
    </p>
   </div>
   <div class="admonitionblock note">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-note" title="Note">
        </i>
       </td>
       <td class="content">
        This page only describes working with the 'documentation' portion of the website. Other portions are written in markdown and built using Hugo.
       </td>
      </tr>
     </table>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_simple_changes">
   <a class="anchor" href="#_simple_changes">
   </a>
   Simple changes
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     If there’s an
     <code>
      edit this page
     </code>
     button at the top right of the page and you wish to propose a simple change such as fixing a typo or rewording something, use this
     <a class="xref page" href="faq/how-do-i-edit-the-website.html">
      very simple process
     </a>
     . For more complicated changes, including changing xrefs, adding, removing or renaming pages, and significant organizational changes, please use the process described on this page.
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_where_to_find_the_documentation">
   <a class="anchor" href="#_where_to_find_the_documentation">
   </a>
   Where to find the documentation
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     All of the documentation accessible in the left-hand navigation panel in the documentation portion of the website is managed in the
     <a href="https://asciidoc.org/">
      AsciiDoc format
     </a>
     and built with the
     <a href="https://antora.org">
      Antora
     </a>
     static site generator. As of November 2021, by far the most capable Asciidoc editor is the Intellij Asciidoc plugin, which works with all Intellij editor products including the free IDEA Community Edition. The plugin preview is more capable than viewing a local Asciidoc file with a browser plugin as it has some understanding of Antora structure. Note that the only reliable way to preview your changes is with a full build of the Antora portion of the website.
    </p>
   </div>
   <div class="paragraph">
    <p>
     The files have the extension
     <code>
      .adoc
     </code>
     and are managed in the Camel repositories. General documentation is usually directly editable. Component specific documentation is partially or entirely generated from other metadata sources which are in turn generated from the code, often from javadoc. Altering generated documentation requires finding the original source, which varies by project. Editable pages are found in several different places in the repositories:
    </p>
   </div>
   <div class="dlist">
    <dl>
     <dt class="hdlist1">
      Main camel repository
     </dt>
     <dd>
      <div class="dlist">
       <dl>
        <dt class="hdlist1">
         Camel components
        </dt>
        <dd>
         <p>
          In the
          <code>
           src/main/docs
          </code>
          folder for the component or camel module. These are symlinked to under
          <code>
           docs/components
          </code>
          .
         </p>
        </dd>
        <dt class="hdlist1">
         EIPs
        </dt>
        <dd>
         <p>
          In the
          <code>
           core/camel-core-engine/src/main/docs
          </code>
          folder.
         </p>
        </dd>
        <dt class="hdlist1">
         Core languages
        </dt>
        <dd>
         <p>
          In the
          <code>
           core/camel-core-languages/src/main/docs
          </code>
          folder. Note that many languages are under
          <code>
           components
          </code>
          .
         </p>
        </dd>
        <dt class="hdlist1">
         User manual and FAQS
        </dt>
        <dd>
         <p>
          In the
          <code>
           /docs/user-manual
          </code>
          folder.
         </p>
        </dd>
       </dl>
      </div>
     </dd>
     <dt class="hdlist1">
      Camel Karaf
     </dt>
     <dd>
      <p>
       In the
       <code>
        docs
       </code>
       folder.
      </p>
     </dd>
     <dt class="hdlist1">
      Camel Spring Boot
     </dt>
     <dd>
      <p>
       Most documentation is generated and appended to the component documentation it applies to. Editable pages are under
       <code>
        docs/spring-boot
       </code>
       and
       <code>
        core/camel-spring-boot/src/main/docs
       </code>
       and
       <code>
        core/camel-spring-boot-xml/src/main/docs
       </code>
       .
      </p>
     </dd>
     <dt class="hdlist1">
      Other subprojects
     </dt>
     <dd>
      <div class="dlist">
       <dl>
        <dt class="hdlist1">
         camel-k, camel-k-runtime
        </dt>
        <dd>
         <p>
          Under
          <code>
           docs
          </code>
          . There is no generated
          <code>
           camel-k
          </code>
          documentation.
         </p>
        </dd>
        <dt class="hdlist1">
         camel-kafka-connector
        </dt>
        <dd>
         <p>
          Editable pages are under
          <code>
           docs
          </code>
          . Most documentation is generated directly from the generated json files for each connector under
          <code>
           connectors/&lt;connector-name&gt;/src/generated/resources
          </code>
          .
         </p>
        </dd>
        <dt class="hdlist1">
         camel-kamelets
        </dt>
        <dd>
         <p>
          Only
          <code>
           docs/modules/ROOT/pages/index.adoc
          </code>
          is editable. All other documentation is generated from the kamelet yaml descriptors.
         </p>
        </dd>
        <dt class="hdlist1">
         camel-quarkus
        </dt>
        <dd>
         <p>
          Editable pages are under
          <code>
           docs
          </code>
          . Pages under
          <code>
           docs/modules/ROOT/pages/reference/components
          </code>
          and
          <code>
           docs/modules/ROOT/pages/reference/extensions
          </code>
          are generated, including optional snippets from e.g.
          <code>
           extensions/activemq/src/main/doc
          </code>
          .
         </p>
        </dd>
        <dt class="hdlist1">
         camel-quarkus-examples
        </dt>
        <dd>
         <p>
          Editable pages are under
          <code>
           docs
          </code>
          .
         </p>
        </dd>
       </dl>
      </div>
     </dd>
    </dl>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_local_build_instructions">
   <a class="anchor" href="#_local_build_instructions">
   </a>
   How to build the website locally, with your changes
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     First, make sure you have yarn, version &gt;= 3.1.0, installed globally.
    </p>
   </div>
   <div class="paragraph">
    <p>
     All three builds rely on a 'site-manifest' that lists the contents of the site with enough detail so that Antora knows about all the pages.
    </p>
   </div>
   <div class="admonitionblock note">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-note" title="Note">
        </i>
       </td>
       <td class="content">
        The following procedure is not available in all subprojects yet. If there is no
        <code>
         docs/local-build.sh
        </code>
        in the one you are working on, please ping djencks on zulip and I’ll try to get it in soon.
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_directory_layout_and_initial_setup">
     <a class="anchor" href="#_directory_layout_and_initial_setup">
     </a>
     Directory layout and initial setup
    </h3>
    <div class="paragraph">
     <p>
      You need a single directory, such as
      <code>
       camel
      </code>
      , that contains all the camel subprojects you are working with, and the
      <code>
       camel-website
      </code>
      project.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">cd camel
git clone https://github.com/apache/camel-website.git</code></pre>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_quick_partial_build">
     <a class="anchor" href="#_quick_partial_build">
     </a>
     Quick partial build
    </h3>
    <div class="paragraph">
     <p>
      In your project, run
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">./local-build.sh quick</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This will build your local subproject substituted into the main Camel website build. It will check syntax in your local subproject, and xrefs within it and from it to the rest of the site. It will not check xrefs into your subproject.
     </p>
    </div>
    <div class="paragraph">
     <p>
      Under
      <code>
       camel-website/documentation
      </code>
      you will find only the pages for your subproject. Looking at this in a browser, links within the subproject will stay in the local pages, and links to the rest of the site will go to the main camel site. There is no obvious way to get back to your local pages.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_full_local_antora_build">
     <a class="anchor" href="#_full_local_antora_build">
     </a>
     Full local Antora build
    </h3>
    <div class="paragraph">
     <p>
      You only have to do this once, and again whenever there are significant changes to the website.
     </p>
    </div>
    <div class="paragraph">
     <p>
      In your project, run
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">./local-build.sh full</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This will build the entire site, including your changes in your branch, and generate a 'site-manifest' listing all the contents of the website, that can be used to build only small parts of the site. This full build will also check that all xrefs into your subproject branch are valid.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_subsequent_partial_continuous_builds">
     <a class="anchor" href="#_subsequent_partial_continuous_builds">
     </a>
     Subsequent partial continuous builds
    </h3>
    <div class="paragraph">
     <p>
      After this full build completes, you can work on documentation with live updates in your browser by running
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">./local-build.sh</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      This will do an initial build of just the current branch in the current subproject, incorporating it into the full site built in the full build, start a web server to serve the site, set up browser-sync on pages you are looking at in your browser, and rebuild the (partial) site as it detects changes. Depending on the amount of content generation Antora is doing, this may take up to a minute or so.
     </p>
    </div>
    <div class="paragraph">
     <p>
      This partial build will detect broken xrefs within your branch and from your branch to the main site, but will not (yet) detect broken xrefs from the rest of the site into your branch. If you rename or remove a page please do a full build or check the PR build carefully for broken xrefs.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_viewing_a_full_build_in_httpd">
     <a class="anchor" href="#_viewing_a_full_build_in_httpd">
     </a>
     Viewing a full build in httpd
    </h3>
    <div class="paragraph">
     <p>
      If you do a full build (
      <code>
       yarn build-all
      </code>
      or
      <code>
       yarn build
      </code>
      rather than
      <code>
       yarn build:antora
      </code>
      or use of the
      <code>
       local-build.sh
      </code>
      script in a subproject) and have Docker available locally you can view your build served with httpd by running
      <code>
       local-httpd-in-docker.sh
      </code>
      . This is especially valuable to check redirects set up with
      <code>
       page-aliases
      </code>
      .
     </p>
    </div>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_creating_a_documentation_pull_request">
   <a class="anchor" href="#_creating_a_documentation_pull_request">
   </a>
   Creating a documentation pull request.
  </h2>
  <div class="sectionbody">
   <div class="admonitionblock note">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-note" title="Note">
        </i>
       </td>
       <td class="content">
        Simple changes such as typo fixes or rewording can usually be done directly at GitHub after pressing the
        <code>
         edit this page
        </code>
        button at the top left of each page. Note that if the page source starts with a comment that the page is copied or generated this will not work! Please do not use this method if you are changing any xrefs or making significant changes to format; instead follow the procedure below.
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="olist arabic">
    <ol class="arabic">
     <li>
      <p>
       Fork/clone the appropriate repository from GitHub and switch to the branch you are working with.
      </p>
     </li>
     <li>
      <p>
       Create a branch for your work with a name starting with the original branch name, e.g.
       <code>
        git switch -c main-doc-fix
       </code>
      </p>
     </li>
     <li>
      <p>
       Edit the
       <code>
        .adoc
       </code>
       sources as needed. Preview your work in the Intellij Asciidoc plugin preview or in a browser with an Asciidoctor extension installed.
      </p>
     </li>
     <li>
      <p>
       Do a
       <a href="#_local_build_instructions">
        local website build with your changes
       </a>
       .
      </p>
     </li>
     <li>
      <p>
       Commit and push your work and create a PR in the (sub)project repository.
      </p>
     </li>
     <li>
      <p>
       Fork/clone the camel-website repository, and create an appropriate branch, e.g.
       <code>
        git switch -c camel-quarkus-main-456
       </code>
       . The following process will work for any number of doc PRs against any number of source repositories: usually you will have one subproject repo and one branch.
      </p>
     </li>
     <li>
      <p>
       Locate the
       <code>
        - url
       </code>
       of the project(s) you are working with in the
       <code>
        antora-playbook.yml
       </code>
       under
       <code>
        sources
       </code>
       , and locate the branch(es) you have altered under that
       <code>
        - url
       </code>
       .
      </p>
     </li>
     <li>
      <p>
       Add something like this to the end of the
       <code>
        antora-playbook.yml
       </code>
       :
      </p>
      <div class="openblock">
       <div class="content">
        <div class="listingblock">
         <div class="content">
          <pre class="highlightjs highlight"><code class="language-yml hljs" data-lang="yml">    - require: '@djencks/antora-source-map'
#      log_level: trace <i class="conum" data-value="1"></i><b>(1)</b>
      source-map: <i class="conum" data-value="2"></i><b>(2)</b>
        - url: 'https://github.com/apache/camel-kamelets.git' <i class="conum" data-value="3"></i><b>(3)</b>
          mapped-url: 'https://github.com/djencks/camel-kamelets.git' <i class="conum" data-value="4"></i><b>(4)</b>
          branches: <i class="conum" data-value="5"></i><b>(5)</b>
            - branch: main <i class="conum" data-value="6"></i><b>(6)</b>
              mapped-branch: main-collect <i class="conum" data-value="7"></i><b>(7)</b>
            - branch: 0.6.x
              mapped-branch: 0.6.x-collect
            - branch: 0.5.x
              mapped-branch: 0.5.x-collect</code></pre>
         </div>
        </div>
        <div class="colist arabic">
         <div class="table-wrapper">
          <table>
           <tr>
            <td>
             <i class="conum" data-value="1">
             </i>
             <b>
              1
             </b>
            </td>
            <td>
             Turning on trace logging will show you in great detail what’s changed from the regular playbook, which can be useful if the build is not doing what you expect.
            </td>
           </tr>
           <tr>
            <td>
             <i class="conum" data-value="2">
             </i>
             <b>
              2
             </b>
            </td>
            <td>
             List of source urls to substitute, probably only one.
            </td>
           </tr>
           <tr>
            <td>
             <i class="conum" data-value="3">
             </i>
             <b>
              3
             </b>
            </td>
            <td>
             The GitHub URL of the subproject you are working on.
            </td>
           </tr>
           <tr>
            <td>
             <i class="conum" data-value="4">
             </i>
             <b>
              4
             </b>
            </td>
            <td>
             The GitHub URL of your fork of the subproject.
            </td>
           </tr>
           <tr>
            <td>
             <i class="conum" data-value="5">
             </i>
             <b>
              5
             </b>
            </td>
            <td>
             List of modified branches: probably only one.
            </td>
           </tr>
           <tr>
            <td>
             <i class="conum" data-value="6">
             </i>
             <b>
              6
             </b>
            </td>
            <td>
             Name of the branch your PR will merge into.
            </td>
           </tr>
           <tr>
            <td>
             <i class="conum" data-value="7">
             </i>
             <b>
              7
             </b>
            </td>
            <td>
             Name of your PR branch.
            </td>
           </tr>
          </table>
         </div>
        </div>
       </div>
      </div>
     </li>
     <li>
      <p>
       At this point you can test your playbook changes locally by running
       <code>
        yarn build:antora
       </code>
       or
       <code>
        yarn build
       </code>
       .
      </p>
     </li>
     <li>
      <p>
       Commit the playbook changes, push to your fork of the
       <code>
        camel-website
       </code>
       repository, and open a PR.
      </p>
     </li>
     <li>
      <p>
       If all goes well you will get an email telling you where the Netlify preview is; this is also shown on the PR page.
      </p>
     </li>
     <li>
      <p>
       Check for build problems and examine the preview.
      </p>
     </li>
     <li>
      <p>
       Upon approval, your content PR will be merged. A
       <code>
        camel-website
       </code>
       PR constructed as described here will not need to be merged and may be closed.
      </p>
     </li>
    </ol>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_new_renamed_or_removed_pages">
   <a class="anchor" href="#_new_renamed_or_removed_pages">
   </a>
   New, renamed, or removed pages
  </h2>
  <div class="sectionbody">
   <div class="ulist">
    <ul>
     <li>
      <p>
       Add, rename, or remove the xref for your page in the appropriate nav.adoc file.
      </p>
     </li>
     <li>
      <p>
       Build the entire website and check for broken xrefs: these will appear as errors in the Antora log output.
      </p>
     </li>
    </ul>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_changed_xrefs">
   <a class="anchor" href="#_changed_xrefs">
   </a>
   Changed xrefs
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     First, read
     <a href="#_a_guide_to_xrefs">
      A guide to xrefs
     </a>
    </p>
   </div>
   <div class="ulist">
    <ul>
     <li>
      <p>
       Build the entire website and check for broken xrefs.
      </p>
     </li>
    </ul>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_adding_a_new_component_version">
   <a class="anchor" href="#_adding_a_new_component_version">
   </a>
   Adding a new component version
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     See
     <a class="xref page" href="release-guide-website.html">
      Updating the website after a release
     </a>
     .
    </p>
   </div>
  </div>
 </div>
 <div class="sect1">
  <h2 id="_a_guide_to_xrefs">
   <a class="anchor" href="#_a_guide_to_xrefs">
   </a>
   A guide to xrefs
  </h2>
  <div class="sectionbody">
   <div class="paragraph">
    <p>
     For a general explanation of Antora xref syntax see
     <a href="https://docs.antora.org/antora/3.0/page/xref/">
      the Antora documentation
     </a>
     . Due to the logical structure of the Camel documentation, xrefs will have a very limited choice of structure.
    </p>
   </div>
   <div class="admonitionblock important">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-important" title="Important">
        </i>
       </td>
       <td class="content">
        A bit of confusion is possible here between Antora components and Camel components. Generally an Antora component corresponds more or less to a Camel subproject, and never to a camel commponent. All the camel components are documented in an Antora component named
        <code>
         components
        </code>
        . In this section the word
        <code>
         component
        </code>
        means an Antora component.
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="admonitionblock important">
    <div class="table-wrapper">
     <table>
      <tr>
       <td class="icon">
        <i class="fa icon-important" title="Important">
        </i>
       </td>
       <td class="content">
        Antora components may be
        <code>
         distributed
        </code>
        which means that the content comes from more than one place, possibly from different repositories. For instance, the
        <code>
         components
        </code>
        component has content from the main camel repository under the start_paths
        <code>
         docs/components
        </code>
        and
        <code>
         core/camel-core-engine/src/main/docs
        </code>
        and from the
        <code>
         camel-spring-boot
        </code>
        repository under
        <code>
         components-starter
        </code>
        and
        <code>
         docs/components
        </code>
        . Furthermore the content may not appear in the normal Antora structure but may be collected from a more maven-project-friendly arrangement with an Antora extension.
       </td>
      </tr>
     </table>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_xrefs_within_an_antora_component">
     <a class="anchor" href="#_xrefs_within_an_antora_component">
     </a>
     xrefs within an (Antora) component
    </h3>
    <div class="paragraph">
     <p>
      Generally there will never be a reason to refer from one version of a component to another version. To assure this happens without maintenance issues, leave out the version and component segments from the xref, e.g. in the
      <code>
       components
      </code>
      component
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">xref:eips:enterprise-integration-patterns.adoc[]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      NOT
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">xref:next@components:eips:enterprise-integration-patterns.adoc[]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      Do this no matter how many locations the component is distributed over.
     </p>
    </div>
    <div class="paragraph">
     <p>
      An xref within the same module can leave out the module segment, although it does no harm.
     </p>
    </div>
    <div class="paragraph">
     <p>
      Do not specify the component name: if you do, the link will be to the
      <code>
       latest
      </code>
      (non-prerelease, i.e., non-
      <code>
       next
      </code>
      ) version, not the current version.
     </p>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_links_to_the_user_manual">
     <a class="anchor" href="#_links_to_the_user_manual">
     </a>
     Links to the user manual
    </h3>
    <div class="paragraph">
     <p>
      The user-manual component is
      <a href="https://docs.antora.org/antora/3.0/component-with-no-version/">
       unversioned
      </a>
      . Leave out the version segment. For example, this will link to this page from anywhere in the documentation:
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">xref:manual::improving-the-documentation.adoc[]</code></pre>
     </div>
    </div>
   </div>
   <div class="sect2">
    <h3 id="_links_between_subprojects">
     <a class="anchor" href="#_links_between_subprojects">
     </a>
     Links between subprojects
    </h3>
    <div class="paragraph">
     <p>
      Each camel subproject relates to other subprojects, and each version of a subproject relates to specific versions of these other subprojects. These subproject versions are specified in the
      <code>
       antora.yml
      </code>
      component descriptor for the documentation component for that subproject. Note that for distributed components each start path has a component descriptor but only one has the additional
      <code>
       asciidoc/attributes
      </code>
      key. For example,
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">name: camel-kafka-connector
title: Camel Kafka Connector
version: next
prerelease: true
display-version: Next (Pre-release)

nav:
- modules/ROOT/nav.adoc

asciidoc:
  attributes:
    camel-version: 3.12.x
    camel-k-runtime-version: 1.8.0
    camel-k-version:
    camel-kamelets-version: 0.3.0</code></pre>
     </div>
    </div>
    <div class="admonitionblock note">
     <div class="table-wrapper">
      <table>
       <tr>
        <td class="icon">
         <i class="fa icon-note" title="Note">
         </i>
        </td>
        <td class="content">
         Setting these up is WIP
        </td>
       </tr>
      </table>
     </div>
    </div>
    <div class="paragraph">
     <p>
      Use these attributes to refer to documentation for the related subproject, e.g.
     </p>
    </div>
    <div class="listingblock">
     <div class="content">
      <pre class="highlightjs highlight"><code class="language-adoc hljs" data-lang="adoc">xref{blank}:{camel-version}@components:eips:enterprise-integration-patterns.adoc[]</code></pre>
     </div>
    </div>
    <div class="paragraph">
     <p>
      If there’s a missing attribute, please raise an issue rather than using a concrete version.
     </p>
    </div>
   </div>
  </div>
 </div>
</article>
